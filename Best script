-- Universal Tool v5.0 - Part 1/7
-- Delta Executor - Enhanced Edition
-- TEMEL YAPILANDIRMA + WALK FLING DÃœZELTMESÄ° (FIXED)

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local Workspace = game:GetService("Workspace")

local Player = Players.LocalPlayer
local Mouse = Player:GetMouse()
local Camera = Workspace.CurrentCamera

-- Karakter yÃ¼kleme fonksiyonu
local function GetCharacter()
    return Player.Character or Player.CharacterAdded:Wait()
end

local Character = GetCharacter()
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart", 10)
local Humanoid = Character:WaitForChild("Humanoid", 10)

-- GELÄ°ÅTÄ°RÄ°LMÄ°Å AYARLAR
local Settings = {
    BlackHoleEnabled = false,
    TelekinesisEnabled = false,
    StunEnabled = false,
    RagdollEnabled = false,
    AutoRagdollEnabled = false,
    ESPEnabled = false,
    FlyEnabled = false,
    FlingEnabled = false,
    NoClipEnabled = false,
    GodModeEnabled = false,
    FullBrightEnabled = false,
    PullForce = 50,
    PullRadius = 150,
    TKDistance = 6,
    FlySpeed = 50,
    ESPUpdateRate = 5,
    FlingMultiplier = 100,
    RagdollDetectionRange = 100,
    GodModeHiddenPart = nil,
    ItemESPEnabled = false,
    PlayerESPEnabled = false
}

-- CONNECTIONS & STORAGE
local Connections = {}
local TKObject = nil
local TKHighlight = nil
local StunnedObjects = {}
local RagdolledNPCs = {}
local ESPObjects = {}
local ItemESPObjects = {}
local PlayerESPObjects = {}
local FlyBodyGyro = nil
local FlyBodyVelocity = nil
local FlingPart = nil
local FlingVelocity = nil
local FlingAngular = nil
local NoClipParts = {}
local GodModeClone = nil
local OriginalHumanoid = nil

-- GÃœVENLÄ°/TEHLÄ°KELÄ° NPC LÄ°STELERÄ° (GENÄ°ÅLETÄ°LMÄ°Å)
local DangerousKeywords = {
    "zombie", "enemy", "monster", "creature", "killer", "attack", "hostile",
    "boss", "minion", "demon", "ghost", "skeleton", "spider", "wolf",
    "bear", "dragon", "slime", "goblin", "orc", "bandit", "guard",
    "soldier", "warrior", "fighter", "hunter", "predator", "beast",
    "mutant", "infected", "undead", "evil", "dark", "shadow", "death",
    "kill", "damage", "hurt", "chase", "follow", "target", "aggro",
    "mob", "npc", "ai", "bot", "dummy", "test", "horror", "scp",
    "nextbot", "entity", "backroom", "creep", "alien",
    "rogue", "fiend", "brute", "assassin", "stalker",
    "terror", "nightmare", "abomination", "behemoth", "leviathan",
    "raider", "pirate", "cannibal", "vampire", "werewolf", "phantom"
}

local SafeKeywords = {
    "shop", "vendor", "merchant", "npc", "friendly", "ally", "helper",
    "guide", "quest", "civilian", "villager", "citizen", "pet", "companion",
    "assistant", "clerk", "trader", "seller", "buyer", "customer",
    "teacher", "doctor", "nurse", "priest", "wizard", "mage", "archer",
    "blacksmith", "farmer", "fisherman", "bartender", "chef", "guardian",
    "protector", "healer", "shopkeeper", "questgiver"
}

-- INFINIT YIELD TARZI WALK FLING DÃœZELTMESÄ°
local function CreateInfinityFling()
    if FlingPart and FlingPart.Parent then 
        return FlingPart 
    end
    
    -- Temel fling parÃ§asÄ±
    local flingPart = Instance.new("Part")
    flingPart.Name = "InfinityFlingPart"
    flingPart.Size = Vector3.new(2, 2, 2)
    flingPart.Transparency = 0.8
    flingPart.Material = Enum.Material.Neon
    flingPart.BrickColor = BrickColor.new("Hot pink")
    flingPart.CanCollide = false
    flingPart.Anchored = false
    flingPart.Locked = true
    flingPart.Massless = true
    flingPart.CustomPhysicalProperties = PhysicalProperties.new(0, 0, 0, 0, 0)
    flingPart.Parent = Workspace
    
    -- Mesh
    local mesh = Instance.new("SpecialMesh")
    mesh.MeshType = Enum.MeshType.Sphere
    mesh.Scale = Vector3.new(1.2, 1.2, 1.2)
    mesh.Parent = flingPart
    
    -- ParlaklÄ±k efekti
    local pointLight = Instance.new("PointLight")
    pointLight.Brightness = 5
    pointLight.Range = 15
    pointLight.Color = Color3.fromRGB(255, 105, 180)
    pointLight.Parent = flingPart
    
    -- BodyAngularVelocity (Infinit Yield tarzÄ±) - DÃœZELTME
    FlingAngular = Instance.new("BodyAngularVelocity")
    FlingAngular.Name = "FlingAngular"
    FlingAngular.MaxTorque = Vector3.new(math.huge, math.huge, math.huge)
    FlingAngular.AngularVelocity = Vector3.new(0, 99999, 0)
    FlingAngular.P = 100000
    FlingAngular.Parent = flingPart
    
    -- BodyVelocity (hareket iÃ§in) - DÃœZELTME
    FlingVelocity = Instance.new("BodyVelocity")
    FlingVelocity.Name = "FlingVelocity"
    FlingVelocity.MaxForce = Vector3.new(0, 0, 0) -- BaÅŸlangÄ±Ã§ta kapalÄ±
    FlingVelocity.Velocity = Vector3.new(0, 0, 0)
    FlingVelocity.P = 1250
    FlingVelocity.Parent = flingPart
    
    return flingPart
end

-- Ragdoll fonksiyonu - DÃœZELTME
local function ApplyRagdoll(model, duration)
    if not model or RagdolledNPCs[model] then return end
    
    local humanoid = model:FindFirstChildOfClass("Humanoid")
    local rootPart = model:FindFirstChild("HumanoidRootPart") or 
                     model:FindFirstChild("Torso") or 
                     model:FindFirstChild("UpperTorso")
    
    if not humanoid or not rootPart then return end
    
    -- MotorlarÄ± kaydet ve devre dÄ±ÅŸÄ± bÄ±rak
    local disabledMotors = {}
    for _, child in pairs(model:GetDescendants()) do
        if child:IsA("Motor6D") then
            disabledMotors[child] = child.Enabled
            child.Enabled = false
        end
    end
    
    -- Humanoid durumunu kaydet
    local originalState = {
        PlatformStand = humanoid.PlatformStand,
        AutoRotate = humanoid.AutoRotate
    }
    
    humanoid.PlatformStand = true
    humanoid.AutoRotate = false
    
    -- Ragdoll etiketi
    local ragdollTag = Instance.new("BillboardGui")
    ragdollTag.Name = "FlingRagdoll"
    ragdollTag.Size = UDim2.new(0, 100, 0, 40)
    ragdollTag.StudsOffset = Vector3.new(0, 3, 0)
    ragdollTag.Adornee = rootPart
    ragdollTag.AlwaysOnTop = true
    ragdollTag.Parent = rootPart
    
    local tagLabel = Instance.new("TextLabel")
    tagLabel.Size = UDim2.new(1, 0, 1, 0)
    tagLabel.BackgroundTransparency = 1
    tagLabel.Text = "ğŸ’¥ FLUNG"
    tagLabel.TextColor3 = Color3.fromRGB(255, 50, 50)
    tagLabel.TextSize = 16
    tagLabel.Font = Enum.Font.GothamBold
    tagLabel.Parent = ragdollTag
    
    RagdolledNPCs[model] = {
        Humanoid = humanoid,
        OriginalState = originalState,
        Tag = ragdollTag,
        DisabledMotors = disabledMotors
    }
    
    -- Belirtilen sÃ¼re sonra ragdoll'u kaldÄ±r
    task.delay(duration or 10, function()
        if not RagdolledNPCs[model] then return end
        
        -- MotorlarÄ± geri aÃ§
        for motor, wasEnabled in pairs(disabledMotors) do
            if motor and motor.Parent then
                motor.Enabled = wasEnabled
            end
        end
        
        -- Humanoid durumunu geri yÃ¼kle
        if humanoid and humanoid.Parent then
            humanoid.PlatformStand = originalState.PlatformStand
            humanoid.AutoRotate = originalState.AutoRotate
        end
        
        -- Tag'i temizle
        if ragdollTag and ragdollTag.Parent then
            ragdollTag:Destroy()
        end
        
        RagdolledNPCs[model] = nil
    end)
end

-- Fling uygulama fonksiyonu - DÃœZELTME
local function ApplyFling(target, fromPosition)
    if not target or not fromPosition then return end
    
    local model = target.Parent
    if not model or not model:IsA("Model") then return end
    
    local humanoid = model:FindFirstChildOfClass("Humanoid")
    local rootPart = model:FindFirstChild("HumanoidRootPart") or 
                     model:FindFirstChild("Torso") or 
                     model:FindFirstChild("UpperTorso")
    
    if not humanoid or not rootPart then return end
    if Players:GetPlayerFromCharacter(model) then return end -- OyuncularÄ± atla
    
    -- Fling yÃ¶nÃ¼ ve gÃ¼cÃ¼
    local direction = (rootPart.Position - fromPosition).Unit
    local horizontalForce = Settings.FlingMultiplier * 50
    local verticalForce = Settings.FlingMultiplier * 100 + 50
    
    local force = Vector3.new(
        direction.X * horizontalForce,
        math.abs(direction.Y) * verticalForce,
        direction.Z * horizontalForce
    )
    
    -- Velocity uygula
    rootPart.AssemblyLinearVelocity = force
    
    -- Ragdoll uygula
    ApplyRagdoll(model, 10)
    
    -- Ekstra momentum (hypersonic efekt)
    task.spawn(function()
        for i = 1, 3 do
            if rootPart and rootPart.Parent then
                rootPart.AssemblyLinearVelocity = rootPart.AssemblyLinearVelocity + Vector3.new(
                    math.random(-100, 100),
                    math.random(50, 150),
                    math.random(-100, 100)
                )
            end
            task.wait(0.1)
        end
    end)
end

-- Fling parÃ§asÄ±nÄ± karaktere baÄŸlama - DÃœZELTME
local function AttachFlingToCharacter()
    if not Character or not HumanoidRootPart then 
        warn("âš ï¸ Karakter veya HumanoidRootPart bulunamadÄ±!")
        return false
    end
    
    -- Eski parÃ§ayÄ± temizle
    if FlingPart and FlingPart.Parent then
        FlingPart:Destroy()
    end
    
    -- Yeni parÃ§a oluÅŸtur
    FlingPart = CreateInfinityFling()
    
    if not FlingPart then
        warn("âš ï¸ Fling parÃ§asÄ± oluÅŸturulamadÄ±!")
        return false
    end
    
    -- Karaktere baÄŸlama (Weld ile)
    local weld = Instance.new("Weld")
    weld.Name = "FlingWeld"
    weld.Part0 = HumanoidRootPart
    weld.Part1 = FlingPart
    weld.C0 = CFrame.new(0, -2, 0) -- AyaklarÄ±n altÄ±nda
    weld.Parent = FlingPart
    
    -- Collision event - DÃœZELTME
    local touchedConnection
    touchedConnection = FlingPart.Touched:Connect(function(hit)
        if not Settings.FlingEnabled then return end
        if not hit or not hit.Parent then return end
        
        -- Debounce kontrolÃ¼
        if hit:FindFirstChild("FlingDebounce") then return end
        
        local debounce = Instance.new("BoolValue")
        debounce.Name = "FlingDebounce"
        debounce.Parent = hit
        game:GetService("Debris"):AddItem(debounce, 0.5)
        
        -- Fling uygula
        ApplyFling(hit, FlingPart.Position)
    end)
    
    Connections.FlingTouched = touchedConnection
    
    return true
end

-- Walk Fling'i etkinleÅŸtirme - DÃœZELTME
local function EnableWalkFling()
    Settings.FlingEnabled = true
    
    -- Karakteri gÃ¼ncelle
    Character = GetCharacter()
    HumanoidRootPart = Character:FindFirstChild("HumanoidRootPart")
    Humanoid = Character:FindFirstChild("Humanoid")
    
    if not HumanoidRootPart or not Humanoid then
        warn("âš ï¸ HumanoidRootPart veya Humanoid bulunamadÄ±!")
        Settings.FlingEnabled = false
        return
    end
    
    -- Fling parÃ§asÄ±nÄ± oluÅŸtur ve baÄŸla
    local success = AttachFlingToCharacter()
    if not success then
        warn("âš ï¸ Fling parÃ§asÄ± baÄŸlanamadÄ±!")
        Settings.FlingEnabled = false
        return
    end
    
    -- Ana loop - DÃœZELTME
    Connections.FlingLoop = RunService.Heartbeat:Connect(function()
        if not Settings.FlingEnabled then return end
        if not FlingPart or not FlingPart.Parent then return end
        if not HumanoidRootPart or not HumanoidRootPart.Parent then return end
        if not Humanoid or not Humanoid.Parent then return end
        
        -- YÃ¼rÃ¼me hÄ±zÄ±na gÃ¶re etki alanÄ±nÄ± ayarla
        local walkSpeed = Humanoid.WalkSpeed
        local multiplier = math.clamp(walkSpeed / 16, 0.5, 3)
        
        -- Velocity gÃ¼ncelleme
        if FlingVelocity and FlingVelocity.Parent then
            -- Sadece hareket ederken aktif
            if HumanoidRootPart.AssemblyLinearVelocity.Magnitude > 1 then
                FlingVelocity.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
                FlingVelocity.Velocity = HumanoidRootPart.AssemblyLinearVelocity * multiplier
            else
                FlingVelocity.MaxForce = Vector3.new(0, 0, 0)
            end
        end
        
        -- YakÄ±ndaki NPC'leri kontrol et (performans optimizasyonu)
        if tick() % 0.1 < 0.016 then -- Her 0.1 saniyede bir
            for _, npc in pairs(Workspace:GetChildren()) do
                if npc:IsA("Model") and npc ~= Character then
                    local npcRoot = npc:FindFirstChild("HumanoidRootPart")
                    local npcHumanoid = npc:FindFirstChildOfClass("Humanoid")
                    
                    if npcRoot and npcHumanoid and not RagdolledNPCs[npc] then
                        local distance = (npcRoot.Position - HumanoidRootPart.Position).Magnitude
                        
                        -- YakÄ±ndaki NPC'lere otomatik fling
                        if distance < 15 then
                            ApplyFling(npcRoot, FlingPart.Position)
                        end
                    end
                end
            end
        end
    end)
    
    -- Klavye kontrolleri - Space ile area fling
    Connections.FlingKeyDown = UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if gameProcessed then return end
        
        -- Space ile area fling
        if input.KeyCode == Enum.KeyCode.Space and FlingPart then
            for _, npc in pairs(Workspace:GetChildren()) do
                if npc:IsA("Model") and npc ~= Character then
                    local rootPart = npc:FindFirstChild("HumanoidRootPart")
                    if rootPart then
                        local distance = (rootPart.Position - FlingPart.Position).Magnitude
                        if distance < 25 then
                            -- Area fling - daha gÃ¼Ã§lÃ¼
                            rootPart.AssemblyLinearVelocity = Vector3.new(
                                math.random(-200, 200),
                                math.random(300, 500),
                                math.random(-200, 200)
                            )
                            ApplyRagdoll(npc, 5)
                        end
                    end
                end
            end
        end
    end)
    
    -- Mobile touch desteÄŸi - DÃœZELTME
    if UserInputService.TouchEnabled then
        Connections.FlingTouch = UserInputService.TouchTap:Connect(function(touchPositions, gameProcessed)
            if gameProcessed then return end
            
            local touchPos = touchPositions[1]
            local ray = Camera:ViewportPointToRay(touchPos.X, touchPos.Y)
            
            local raycastParams = RaycastParams.new()
            raycastParams.FilterType = Enum.RaycastFilterType.Blacklist
            raycastParams.FilterDescendantsInstances = {Character}
            
            local result = Workspace:Raycast(ray.Origin, ray.Direction * 1000, raycastParams)
            
            if result and result.Instance then
                ApplyFling(result.Instance, HumanoidRootPart.Position)
            end
        end)
    end
    
    print("âœ… Walk Fling Aktif (Infinit Yield tarzÄ±)")
    print("   â€¢ Space: Alan fÄ±rlatma (25 stud)")
    print("   â€¢ Walk: Otomatik NPC fÄ±rlatma (15 stud)")
    if UserInputService.TouchEnabled then
        print("   â€¢ Touch: NPC'leri fÄ±rlat")
    end
end

-- Walk Fling'i devre dÄ±ÅŸÄ± bÄ±rakma - DÃœZELTME
local function DisableWalkFling()
    Settings.FlingEnabled = false
    
    -- Fling parÃ§asÄ±nÄ± temizle
    if FlingPart and FlingPart.Parent then
        FlingPart:Destroy()
    end
    FlingPart = nil
    FlingVelocity = nil
    FlingAngular = nil
    
    -- BaÄŸlantÄ±larÄ± temizle
    for name, connection in pairs(Connections) do
        if name:match("Fling") and connection then
            connection:Disconnect()
            Connections[name] = nil
        end
    end
    
    -- Ragdoll'larÄ± temizle
    for model, data in pairs(RagdolledNPCs) do
        if data.Humanoid and data.Humanoid.Parent then
            -- MotorlarÄ± geri aÃ§
            for motor, wasEnabled in pairs(data.DisabledMotors or {}) do
                if motor and motor.Parent then
                    motor.Enabled = wasEnabled
                end
            end
            
            -- Humanoid durumunu geri yÃ¼kle
            data.Humanoid.PlatformStand = data.OriginalState.PlatformStand
            data.Humanoid.AutoRotate = data.OriginalState.AutoRotate
            
            -- Tag'i temizle
            if data.Tag and data.Tag.Parent then
                data.Tag:Destroy()
            end
        end
    end
    
    RagdolledNPCs = {}
    
    print("âŒ Walk Fling KapalÄ±")
end

-- KARAKTER YENÄ°LENME TAKÄ°BÄ° - DÃœZELTME
Player.CharacterAdded:Connect(function(char)
    Character = char
    HumanoidRootPart = char:WaitForChild("HumanoidRootPart", 10)
    Humanoid = char:WaitForChild("Humanoid", 10)
    
    -- Fling aktifse yeniden baÄŸla
    if Settings.FlingEnabled then
        task.wait(1) -- Karakterin tam yÃ¼klenmesini bekle
        EnableWalkFling()
    end
end)

-- OYUN BAÅLANGICI
task.spawn(function()
    task.wait(1)
    print("=== PART 1 YÃœKLENDÄ° (FIXED) ===")
    print("ğŸ“¦ Ã–zellikler:")
    print("   âœ… DÃ¼zeltilmiÅŸ Walk Fling (Infinit Yield tarzÄ±)")
    print("   âœ… TPUNCHORD mantÄ±ÄŸÄ± ile hypersonic fling")
    print("   âœ… Otomatik NPC ragdoll sistemi")
    print("   âœ… Mobile touch desteÄŸi")
    print("   âœ… Karakter yenileme desteÄŸi")
    print("   âœ… Performans optimizasyonlarÄ±")
    print("   âœ… Debounce sistemi")
    print("==========================")
end)

-- TEST KOMUTLARI (konsola yazÄ±n)
_G.EnableFling = EnableWalkFling
_G.DisableFling = DisableWalkFling

print("ğŸ’¡ Test iÃ§in: _G.EnableFling() veya _G.DisableFling()")-- Universal Tool v5.0 - Part 2/7
-- MOBÄ°LE FLY SÄ°STEMÄ° + NO CLIP

-- Servisler
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

-- DeÄŸiÅŸkenler
local Player = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local Character = Player.Character or Player.CharacterAdded:Wait()
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")

-- Ayarlar
local Settings = {
    FlySpeed = 50,
    FlyEnabled = false,
    NoClipEnabled = false
}

-- BaÄŸlantÄ±lar
local Connections = {}
local NoClipParts = {}
local FlyBodyGyro = nil
local FlyBodyVelocity = nil

-- Karakter alma fonksiyonu
local function GetCharacter()
    return Player.Character or Player.CharacterAdded:Wait()
end

-- PART 1'den devam ediyoruz...
local function CreateMobileFlyControls()
    -- Mobile Fly iÃ§in kontrol GUI'si
    local flyControlsGui = Instance.new("ScreenGui")
    flyControlsGui.Name = "MobileFlyControls"
    flyControlsGui.ResetOnSpawn = false
    flyControlsGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    
    -- CoreGui'ye yerleÅŸtirme (hata kontrolÃ¼ ile)
    local success, err = pcall(function()
        flyControlsGui.Parent = game:GetService("CoreGui")
    end)
    
    if not success then
        flyControlsGui.Parent = Player:WaitForChild("PlayerGui")
    end
    
    -- Ana kontrol paneli (saÄŸ alt kÃ¶ÅŸe)
    local controlPanel = Instance.new("Frame")
    controlPanel.Name = "ControlPanel"
    controlPanel.Size = UDim2.new(0, 280, 0, 280)
    controlPanel.Position = UDim2.new(1, -300, 1, -300)
    controlPanel.BackgroundTransparency = 1
    controlPanel.Parent = flyControlsGui
    
    -- UICorner ekle
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 12)
    
    -- Joystick (hareket kontrolÃ¼)
    local joystickOuter = Instance.new("Frame")
    joystickOuter.Name = "JoystickOuter"
    joystickOuter.Size = UDim2.new(0, 120, 0, 120)
    joystickOuter.Position = UDim2.new(0, 20, 1, -140)
    joystickOuter.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
    joystickOuter.BackgroundTransparency = 0.4
    joystickOuter.BorderSizePixel = 0
    joystickOuter.Parent = controlPanel
    
    local outerCorner = corner:Clone()
    outerCorner.CornerRadius = UDim.new(1, 0)
    outerCorner.Parent = joystickOuter
    
    local joystickInner = Instance.new("Frame")
    joystickInner.Name = "JoystickInner"
    joystickInner.Size = UDim2.new(0, 60, 0, 60)
    joystickInner.Position = UDim2.new(0.5, -30, 0.5, -30)
    joystickInner.BackgroundColor3 = Color3.fromRGB(100, 150, 255)
    joystickInner.BackgroundTransparency = 0.3
    joystickInner.BorderSizePixel = 0
    joystickInner.Parent = joystickOuter
    
    local innerCorner = corner:Clone()
    innerCorner.CornerRadius = UDim.new(1, 0)
    innerCorner.Parent = joystickInner
    
    -- YÃ¼kseklik kontrol butonlarÄ±
    local upButton = Instance.new("TextButton")
    upButton.Name = "UpButton"
    upButton.Size = UDim2.new(0, 80, 0, 80)
    upButton.Position = UDim2.new(1, -100, 0.5, -140)
    upButton.BackgroundColor3 = Color3.fromRGB(80, 180, 120)
    upButton.BackgroundTransparency = 0.3
    upButton.BorderSizePixel = 0
    upButton.Text = "â¬†"
    upButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    upButton.TextSize = 24
    upButton.Font = Enum.Font.GothamBold
    upButton.Parent = controlPanel
    
    local upCorner = corner:Clone()
    upCorner.Parent = upButton
    
    local downButton = Instance.new("TextButton")
    downButton.Name = "DownButton"
    downButton.Size = UDim2.new(0, 80, 0, 80)
    downButton.Position = UDim2.new(1, -100, 0.5, -40)
    downButton.BackgroundColor3 = Color3.fromRGB(180, 80, 80)
    downButton.BackgroundTransparency = 0.3
    downButton.BorderSizePixel = 0
    downButton.Text = "â¬‡"
    downButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    downButton.TextSize = 24
    downButton.Font = Enum.Font.GothamBold
    downButton.Parent = controlPanel
    
    local downCorner = corner:Clone()
    downCorner.Parent = downButton
    
    -- HÄ±z kontrol slider'Ä±
    local speedPanel = Instance.new("Frame")
    speedPanel.Name = "SpeedPanel"
    speedPanel.Size = UDim2.new(0, 200, 0, 40)
    speedPanel.Position = UDim2.new(0, 40, 0, 20)
    speedPanel.BackgroundColor3 = Color3.fromRGB(30, 30, 50)
    speedPanel.BackgroundTransparency = 0.3
    speedPanel.BorderSizePixel = 0
    speedPanel.Parent = controlPanel
    
    local speedCorner = corner:Clone()
    speedCorner.Parent = speedPanel
    
    local speedLabel = Instance.new("TextLabel")
    speedLabel.Name = "SpeedLabel"
    speedLabel.Size = UDim2.new(0.4, 0, 1, 0)
    speedLabel.Position = UDim2.new(0, 10, 0, 0)
    speedLabel.BackgroundTransparency = 1
    speedLabel.Text = "Speed: " .. Settings.FlySpeed
    speedLabel.TextColor3 = Color3.fromRGB(200, 200, 255)
    speedLabel.TextSize = 14
    speedLabel.Font = Enum.Font.Gotham
    speedLabel.TextXAlignment = Enum.TextXAlignment.Left
    speedLabel.Parent = speedPanel
    
    local speedSlider = Instance.new("Frame")
    speedSlider.Name = "SpeedSlider"
    speedSlider.Size = UDim2.new(0.5, 0, 0, 6)
    speedSlider.Position = UDim2.new(0.4, 10, 0.5, -3)
    speedSlider.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
    speedSlider.BorderSizePixel = 0
    speedSlider.Parent = speedPanel
    
    local sliderCorner = corner:Clone()
    sliderCorner.CornerRadius = UDim.new(1, 0)
    sliderCorner.Parent = speedSlider
    
    local speedFill = Instance.new("Frame")
    speedFill.Name = "SpeedFill"
    speedFill.Size = UDim2.new((Settings.FlySpeed - 10) / 190, 0, 1, 0)
    speedFill.BackgroundColor3 = Color3.fromRGB(100, 150, 255)
    speedFill.BorderSizePixel = 0
    speedFill.Parent = speedSlider
    
    local fillCorner = corner:Clone()
    fillCorner.CornerRadius = UDim.new(1, 0)
    fillCorner.Parent = speedFill
    
    local speedKnob = Instance.new("Frame")
    speedKnob.Name = "SpeedKnob"
    speedKnob.Size = UDim2.new(0, 12, 0, 12)
    speedKnob.Position = UDim2.new((Settings.FlySpeed - 10) / 190, -6, 0.5, -6)
    speedKnob.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    speedKnob.BorderSizePixel = 0
    speedKnob.Parent = speedSlider
    
    local knobCorner = corner:Clone()
    knobCorner.CornerRadius = UDim.new(1, 0)
    knobCorner.Parent = speedKnob
    
    -- Mobile kontrol deÄŸiÅŸkenleri
    local mobileFlyControls = {
        JoystickActive = false,
        JoystickPosition = Vector2.new(0, 0),
        JoystickStartPos = Vector2.new(0, 0),
        JoystickOuterPos = Vector2.new(0, 0),
        UpPressed = false,
        DownPressed = false,
        SpeedDragging = false
    }
    
    -- Joystick kontrolÃ¼
    local joystickConnection
    joystickOuter.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseButton1 then
            mobileFlyControls.JoystickActive = true
            mobileFlyControls.JoystickStartPos = Vector2.new(input.Position.X, input.Position.Y)
            mobileFlyControls.JoystickOuterPos = Vector2.new(
                joystickOuter.AbsolutePosition.X + joystickOuter.AbsoluteSize.X / 2,
                joystickOuter.AbsolutePosition.Y + joystickOuter.AbsoluteSize.Y / 2
            )
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if mobileFlyControls.JoystickActive and (input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseMovement) then
            local delta = Vector2.new(input.Position.X, input.Position.Y) - mobileFlyControls.JoystickStartPos
            local maxDistance = joystickOuter.AbsoluteSize.X / 2 - joystickInner.AbsoluteSize.X / 2
            
            delta = Vector2.new(
                math.clamp(delta.X, -maxDistance, maxDistance),
                math.clamp(delta.Y, -maxDistance, maxDistance)
            )
            
            mobileFlyControls.JoystickPosition = Vector2.new(
                delta.X / maxDistance,
                -delta.Y / maxDistance
            )
            
            -- Joystick gÃ¶rselini gÃ¼ncelle
            joystickInner.Position = UDim2.new(
                0.5, delta.X,
                0.5, delta.Y
            )
        end
        
        if mobileFlyControls.SpeedDragging and (input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseMovement) then
            local xPos = math.clamp(
                input.Position.X - speedSlider.AbsolutePosition.X,
                0, speedSlider.AbsoluteSize.X
            )
            
            local percent = xPos / speedSlider.AbsoluteSize.X
            Settings.FlySpeed = math.floor(10 + percent * 190)
            
            speedFill.Size = UDim2.new(percent, 0, 1, 0)
            speedKnob.Position = UDim2.new(percent, -6, 0.5, -6)
            speedLabel.Text = "Speed: " .. Settings.FlySpeed
        end
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseButton1 then
            if mobileFlyControls.JoystickActive then
                mobileFlyControls.JoystickActive = false
                mobileFlyControls.JoystickPosition = Vector2.new(0, 0)
                
                -- Joystick'i sÄ±fÄ±rla
                joystickInner.Position = UDim2.new(0.5, -30, 0.5, -30)
            end
            
            if mobileFlyControls.SpeedDragging then
                mobileFlyControls.SpeedDragging = false
            end
        end
    end)
    
    -- Buton kontrolleri
    upButton.MouseButton1Down:Connect(function()
        mobileFlyControls.UpPressed = true
        upButton.BackgroundTransparency = 0.1
    end)
    
    upButton.MouseButton1Up:Connect(function()
        mobileFlyControls.UpPressed = false
        upButton.BackgroundTransparency = 0.3
    end)
    
    downButton.MouseButton1Down:Connect(function()
        mobileFlyControls.DownPressed = true
        downButton.BackgroundTransparency = 0.1
    end)
    
    downButton.MouseButton1Up:Connect(function()
        mobileFlyControls.DownPressed = false
        downButton.BackgroundTransparency = 0.3
    end)
    
    -- Slider kontrolÃ¼
    speedSlider.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseButton1 then
            mobileFlyControls.SpeedDragging = true
        end
    end)
    
    -- GUI'yi baÅŸlangÄ±Ã§ta gizle
    flyControlsGui.Enabled = false
    
    return {
        GUI = flyControlsGui,
        Controls = mobileFlyControls
    }
end

-- MOBÄ°LE UYUMLU FLY SÄ°STEMÄ°
local MobileFlyGUI = nil
local MobileControls = nil

local function EnableMobileFly()
    Settings.FlyEnabled = true
    
    Character = GetCharacter()
    HumanoidRootPart = Character:FindFirstChild("HumanoidRootPart")
    
    if not HumanoidRootPart then
        warn("HumanoidRootPart bulunamadÄ±!")
        return
    end
    
    local humanoid = Character:FindFirstChildOfClass("Humanoid")
    if humanoid then
        humanoid.PlatformStand = true
    end
    
    -- BodyGyro (yÃ¶n kontrolÃ¼)
    FlyBodyGyro = Instance.new("BodyGyro")
    FlyBodyGyro.Name = "FlyBodyGyro"
    FlyBodyGyro.MaxTorque = Vector3.new(40000, 40000, 40000)
    FlyBodyGyro.P = 1000
    FlyBodyGyro.D = 100
    FlyBodyGyro.CFrame = HumanoidRootPart.CFrame
    FlyBodyGyro.Parent = HumanoidRootPart
    
    -- BodyVelocity (hareket)
    FlyBodyVelocity = Instance.new("BodyVelocity")
    FlyBodyVelocity.Name = "FlyBodyVelocity"
    FlyBodyVelocity.MaxForce = Vector3.new(40000, 40000, 40000)
    FlyBodyVelocity.Velocity = Vector3.new(0, 0, 0)
    FlyBodyVelocity.P = 1250
    FlyBodyVelocity.Parent = HumanoidRootPart
    
    -- Mobile kontrol GUI'sini oluÅŸtur
    if not MobileFlyGUI then
        MobileFlyGUI = CreateMobileFlyControls()
        MobileControls = MobileFlyGUI.Controls
    end
    MobileFlyGUI.GUI.Enabled = true
    
    -- Fly kontrol deÄŸiÅŸkenleri
    local flyKeys = {
        W = false, A = false, S = false, D = false,
        Space = false, LeftShift = false
    }
    
    -- KLASÄ°K KLAVYE KONTROLLERÄ°
    Connections.FlyKeyDown = UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if gameProcessed then return end
        
        if input.KeyCode == Enum.KeyCode.W then flyKeys.W = true end
        if input.KeyCode == Enum.KeyCode.A then flyKeys.A = true end
        if input.KeyCode == Enum.KeyCode.S then flyKeys.S = true end
        if input.KeyCode == Enum.KeyCode.D then flyKeys.D = true end
        if input.KeyCode == Enum.KeyCode.Space then flyKeys.Space = true end
        if input.KeyCode == Enum.KeyCode.LeftShift then flyKeys.LeftShift = true end
        
        -- E tuÅŸu ile hÄ±z artÄ±rma
        if input.KeyCode == Enum.KeyCode.E then
            Settings.FlySpeed = math.min(Settings.FlySpeed + 20, 200)
            if MobileFlyGUI then
                MobileFlyGUI.GUI.ControlPanel.SpeedPanel.SpeedLabel.Text = "Speed: " .. Settings.FlySpeed
            end
        end
        
        -- Q tuÅŸu ile hÄ±z azaltma
        if input.KeyCode == Enum.KeyCode.Q then
            Settings.FlySpeed = math.max(Settings.FlySpeed - 20, 10)
            if MobileFlyGUI then
                MobileFlyGUI.GUI.ControlPanel.SpeedPanel.SpeedLabel.Text = "Speed: " .. Settings.FlySpeed
            end
        end
    end)
    
    Connections.FlyKeyUp = UserInputService.InputEnded:Connect(function(input)
        if input.KeyCode == Enum.KeyCode.W then flyKeys.W = false end
        if input.KeyCode == Enum.KeyCode.A then flyKeys.A = false end
        if input.KeyCode == Enum.KeyCode.S then flyKeys.S = false end
        if input.KeyCode == Enum.KeyCode.D then flyKeys.D = false end
        if input.KeyCode == Enum.KeyCode.Space then flyKeys.Space = false end
        if input.KeyCode == Enum.KeyCode.LeftShift then flyKeys.LeftShift = false end
    end)
    
    -- MOBILE JOYSTICK KONTROL LOOP'U
    Connections.FlyLoop = RunService.Heartbeat:Connect(function()
        if not Settings.FlyEnabled or not FlyBodyGyro or not FlyBodyVelocity then return end
        
        pcall(function()
            -- Kamera yÃ¶nÃ¼nÃ¼ takip et
            FlyBodyGyro.CFrame = Camera.CFrame
            
            -- Hareket vektÃ¶rÃ¼
            local moveVector = Vector3.new(0, 0, 0)
            
            -- KLAVYE KONTROLLERÄ°
            if flyKeys.W then moveVector = moveVector + Camera.CFrame.LookVector end
            if flyKeys.S then moveVector = moveVector - Camera.CFrame.LookVector end
            if flyKeys.A then moveVector = moveVector - Camera.CFrame.RightVector end
            if flyKeys.D then moveVector = moveVector + Camera.CFrame.RightVector end
            if flyKeys.Space then moveVector = moveVector + Vector3.new(0, 1, 0) end
            if flyKeys.LeftShift then moveVector = moveVector - Vector3.new(0, 1, 0) end
            
            -- MOBILE JOYSTICK KONTROLLERÄ°
            if MobileControls and MobileControls.JoystickPosition then
                local joyX = MobileControls.JoystickPosition.X
                local joyY = MobileControls.JoystickPosition.Y
                
                if math.abs(joyX) > 0.1 or math.abs(joyY) > 0.1 then
                    moveVector = moveVector + (Camera.CFrame.RightVector * joyX)
                    moveVector = moveVector + (Camera.CFrame.LookVector * joyY)
                end
                
                -- YÃœKSEKLÄ°K KONTROLLERÄ°
                if MobileControls.UpPressed then
                    moveVector = moveVector + Vector3.new(0, 1, 0)
                end
                
                if MobileControls.DownPressed then
                    moveVector = moveVector - Vector3.new(0, 1, 0)
                end
            end
            
            -- HÄ±z limiti ve velocity uygulama
            if moveVector.Magnitude > 0 then
                local speedMultiplier = Settings.FlySpeed
                local targetVel = moveVector.Unit * speedMultiplier
                
                FlyBodyVelocity.Velocity = targetVel
            else
                FlyBodyVelocity.Velocity = Vector3.new(0, 0, 0)
            end
        end)
    end)
    
    print("âœ… Mobile Fly Aktif!")
end

local function DisableMobileFly()
    Settings.FlyEnabled = false
    
    -- Mobile GUI'yi gizle
    if MobileFlyGUI then
        MobileFlyGUI.GUI.Enabled = false
    end
    
    -- Fly bileÅŸenlerini temizle
    pcall(function()
        if FlyBodyGyro then 
            FlyBodyGyro:Destroy() 
            FlyBodyGyro = nil 
        end
        
        if FlyBodyVelocity then 
            FlyBodyVelocity:Destroy() 
            FlyBodyVelocity = nil 
        end
        
        Character = GetCharacter()
        local humanoid = Character and Character:FindFirstChildOfClass("Humanoid")
        if humanoid then
            humanoid.PlatformStand = false
        end
    end)
    
    -- BaÄŸlantÄ±larÄ± temizle
    if Connections.FlyKeyDown then Connections.FlyKeyDown:Disconnect() end
    if Connections.FlyKeyUp then Connections.FlyKeyUp:Disconnect() end
    if Connections.FlyLoop then Connections.FlyLoop:Disconnect() end
    
    print("âŒ Mobile Fly KapalÄ±")
end

-- NO CLIP SÄ°STEMÄ°
local function EnableNoClip()
    Settings.NoClipEnabled = true
    
    Character = GetCharacter()
    
    if not Character then
        warn("Karakter bulunamadÄ±!")
        return
    end
    
    NoClipParts = {}
    
    for _, part in pairs(Character:GetDescendants()) do
        if part:IsA("BasePart") then
            table.insert(NoClipParts, {
                Part = part,
                OriginalCanCollide = part.CanCollide
            })
        end
    end
    
    Connections.NoClipLoop = RunService.Stepped:Connect(function()
        if not Settings.NoClipEnabled then return end
        
        for _, data in pairs(NoClipParts) do
            if data.Part and data.Part.Parent then
                data.Part.CanCollide = false
            end
        end
    end)
    
    print("âœ… No Clip Aktif!")
end

local function DisableNoClip()
    Settings.NoClipEnabled = false
    
    for _, data in pairs(NoClipParts) do
        if data.Part and data.Part.Parent then
            pcall(function()
                data.Part.CanCollide = data.OriginalCanCollide
            end)
        end
    end
    
    NoClipParts = {}
    
    if Connections.NoClipLoop then 
        Connections.NoClipLoop:Disconnect() 
    end
    
    print("âŒ No Clip KapalÄ±")
end

-- Global fonksiyonlar
_G.EnableFly = EnableMobileFly
_G.DisableFly = DisableMobileFly
_G.EnableNoClip = EnableNoClip
_G.DisableNoClip = DisableNoClip

print("âœ… Part 2 YÃ¼klendi - Mobile Fly & NoClip HazÄ±r!")-- Universal Tool v5.0 - Part 3/7
-- GOD MODE + ITEM ESP + PLAYER ESP

-- DEÄÄ°ÅKENLER (Part 1'den devam)
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Player = Players.LocalPlayer
local Character = Player.Character or Player.CharacterAdded:Wait()
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")

-- Ayarlar ve BaÄŸlantÄ±lar
Settings = Settings or {
    GodModeEnabled = false,
    ItemESPEnabled = false,
    PlayerESPEnabled = false,
    ESPEnabled = false
}

Connections = Connections or {}
ItemESPObjects = ItemESPObjects or {}
PlayerESPObjects = PlayerESPObjects or {}

local OriginalHumanoid = nil
local GodModeClone = nil

-- YARDIMCI FONKSÄ°YONLAR
local function GetCharacter()
    return Player.Character
end

-- GOD MODE SÄ°STEMÄ°
local function EnableGodMode()
    Settings.GodModeEnabled = true
    
    Character = GetCharacter()
    if not Character then
        warn("Karakter bulunamadÄ±!")
        return
    end
    
    local humanoid = Character:FindFirstChildOfClass("Humanoid")
    if not humanoid then
        warn("Humanoid bulunamadÄ±!")
        return
    end
    
    OriginalHumanoid = humanoid
    
    local humanRootPart = Character:FindFirstChild("HumanoidRootPart")
    if humanRootPart then
        -- Sonsuz can
        humanoid.MaxHealth = math.huge
        humanoid.Health = math.huge
        
        -- Can yenileme
        Connections.GodModeHeal = RunService.Heartbeat:Connect(function()
            if Settings.GodModeEnabled and humanoid and humanoid.Parent then
                humanoid.Health = humanoid.MaxHealth
            end
        end)
        
        -- ForceField ekle
        local forceField = Character:FindFirstChild("GodModeEffect")
        if not forceField then
            forceField = Instance.new("ForceField")
            forceField.Name = "GodModeEffect"
            forceField.Visible = false
            forceField.Parent = Character
        end
        
        -- NPC saldÄ±rÄ±larÄ±nÄ± engelle
        Connections.GodModeNPC = workspace.DescendantAdded:Connect(function(obj)
            if not Settings.GodModeEnabled then return end
            
            if obj:IsA("BasePart") then
                local objName = obj.Name:lower()
                if objName:find("hitbox") or objName:find("damage") or objName:find("hurt") then
                    pcall(function()
                        obj.CanTouch = false
                        obj.CanCollide = false
                    end)
                end
            end
        end)
        
        -- God Mode gÃ¶stergesi
        local godIndicator = humanRootPart:FindFirstChild("GodModeIndicator")
        if not godIndicator then
            godIndicator = Instance.new("BillboardGui")
            godIndicator.Name = "GodModeIndicator"
            godIndicator.Size = UDim2.new(0, 150, 0, 40)
            godIndicator.StudsOffset = Vector3.new(0, 3.5, 0)
            godIndicator.AlwaysOnTop = true
            godIndicator.Adornee = humanRootPart
            godIndicator.Parent = humanRootPart
            
            local godLabel = Instance.new("TextLabel")
            godLabel.Size = UDim2.new(1, 0, 1, 0)
            godLabel.BackgroundTransparency = 1
            godLabel.Text = "ğŸ‘‘ GOD MODE"
            godLabel.TextColor3 = Color3.fromRGB(255, 215, 0)
            godLabel.TextSize = 18
            godLabel.Font = Enum.Font.GothamBold
            godLabel.TextStrokeTransparency = 0.5
            godLabel.Parent = godIndicator
        end
        
        -- AltÄ±n efekti
        for _, part in pairs(Character:GetDescendants()) do
            if part:IsA("BasePart") and not part:FindFirstChild("GodLight") then
                pcall(function()
                    local light = Instance.new("PointLight")
                    light.Name = "GodLight"
                    light.Brightness = 2
                    light.Range = 12
                    light.Color = Color3.fromRGB(255, 215, 0)
                    light.Parent = part
                end)
            end
        end
        
        print("âœ… God Mode Aktif!")
    else
        warn("HumanoidRootPart bulunamadÄ±!")
    end
end

local function DisableGodMode()
    Settings.GodModeEnabled = false
    
    -- BaÄŸlantÄ±larÄ± temizle
    if Connections.GodModeHeal then 
        Connections.GodModeHeal:Disconnect() 
        Connections.GodModeHeal = nil
    end
    if Connections.GodModeNPC then 
        Connections.GodModeNPC:Disconnect() 
        Connections.GodModeNPC = nil
    end
    
    -- Efektleri temizle
    pcall(function()
        Character = GetCharacter()
        
        if Character then
            local effect = Character:FindFirstChild("GodModeEffect")
            if effect then effect:Destroy() end
            
            local rootPart = Character:FindFirstChild("HumanoidRootPart")
            if rootPart then
                local indicator = rootPart:FindFirstChild("GodModeIndicator")
                if indicator then indicator:Destroy() end
            end
            
            -- IÅŸÄ±klarÄ± temizle
            for _, part in pairs(Character:GetDescendants()) do
                if part:IsA("BasePart") then
                    local light = part:FindFirstChild("GodLight")
                    if light then light:Destroy() end
                end
            end
            
            -- SaÄŸlÄ±ÄŸÄ± normale dÃ¶ndÃ¼r
            local humanoid = Character:FindFirstChildOfClass("Humanoid")
            if humanoid then
                humanoid.MaxHealth = 100
                humanoid.Health = 100
            end
        end
    end)
    
    print("âŒ God Mode KapalÄ±")
end

-- ITEM ESP SÄ°STEMÄ°
local function IsItem(obj)
    if not obj or not obj.Parent then return false end
    
    if obj:IsA("Tool") then return true end
    
    local name = obj.Name:lower()
    local itemKeywords = {
        "sword", "axe", "hammer", "bow", "gun", "weapon", "tool",
        "coin", "money", "gold", "gem", "crystal",
        "health", "potion", "food", "medkit", "ammo",
        "key", "card", "treasure", "chest", "box",
        "armor", "shield", "helmet", "ring"
    }
    
    for _, keyword in pairs(itemKeywords) do
        if name:find(keyword) then return true end
    end
    
    return false
end

local function CreateItemESP(item)
    if not item or ItemESPObjects[item] then return end
    
    local rootPart = nil
    
    if item:IsA("Tool") then
        rootPart = item:FindFirstChild("Handle") or item:FindFirstChildWhichIsA("BasePart")
    elseif item:IsA("BasePart") then
        rootPart = item
    elseif item:IsA("Model") then
        rootPart = item:FindFirstChildWhichIsA("BasePart")
    end
    
    if not rootPart then return end
    
    pcall(function()
        -- Billboard GUI
        local billboard = Instance.new("BillboardGui")
        billboard.Name = "ItemESP_" .. item.Name
        billboard.Size = UDim2.new(0, 150, 0, 40)
        billboard.StudsOffset = Vector3.new(0, 2, 0)
        billboard.AlwaysOnTop = true
        billboard.MaxDistance = 250
        billboard.Adornee = rootPart
        billboard.Parent = rootPart
        
        local frame = Instance.new("Frame")
        frame.Size = UDim2.new(1, 0, 1, 0)
        frame.BackgroundTransparency = 1
        frame.Parent = billboard
        
        local nameLabel = Instance.new("TextLabel")
        nameLabel.Size = UDim2.new(1, 0, 0.5, 0)
        nameLabel.BackgroundTransparency = 1
        nameLabel.Text = item.Name
        nameLabel.TextColor3 = Color3.fromRGB(50, 255, 50)
        nameLabel.TextStrokeTransparency = 0.4
        nameLabel.TextSize = 12
        nameLabel.Font = Enum.Font.GothamBold
        nameLabel.Parent = frame
        
        local distanceLabel = Instance.new("TextLabel")
        distanceLabel.Size = UDim2.new(1, 0, 0.5, 0)
        distanceLabel.Position = UDim2.new(0, 0, 0.5, 0)
        distanceLabel.BackgroundTransparency = 1
        distanceLabel.Text = "Item"
        distanceLabel.TextColor3 = Color3.fromRGB(200, 200, 255)
        distanceLabel.TextStrokeTransparency = 0.4
        distanceLabel.TextSize = 10
        distanceLabel.Font = Enum.Font.Gotham
        distanceLabel.Parent = frame
        
        local highlight = Instance.new("Highlight")
        highlight.Name = "ItemHighlight"
        highlight.Adornee = item
        highlight.FillColor = Color3.fromRGB(0, 255, 0)
        highlight.FillTransparency = 0.8
        highlight.OutlineColor = Color3.fromRGB(0, 200, 0)
        highlight.OutlineTransparency = 0.3
        highlight.Parent = item
        
        ItemESPObjects[item] = {
            Billboard = billboard,
            Highlight = highlight,
            NameLabel = nameLabel,
            DistanceLabel = distanceLabel,
            RootPart = rootPart
        }
    end)
end

local function RemoveItemESP(item)
    if not ItemESPObjects[item] then return end
    
    pcall(function()
        local data = ItemESPObjects[item]
        if data.Billboard then data.Billboard:Destroy() end
        if data.Highlight then data.Highlight:Destroy() end
        ItemESPObjects[item] = nil
    end)
end

local function UpdateItemESP()
    if not Settings.ItemESPEnabled then return end
    
    pcall(function()
        Character = GetCharacter()
        local playerRoot = Character and Character:FindFirstChild("HumanoidRootPart")
        if not playerRoot then return end
        
        for item, data in pairs(ItemESPObjects) do
            if not item or not item.Parent then
                RemoveItemESP(item)
            elseif data.RootPart and data.DistanceLabel then
                local distance = math.floor((data.RootPart.Position - playerRoot.Position).Magnitude)
                data.DistanceLabel.Text = distance .. " studs"
                
                if distance < 20 then
                    data.NameLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
                elseif distance < 50 then
                    data.NameLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
                else
                    data.NameLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
                end
            end
        end
    end)
end

local function EnableItemESP()
    Settings.ItemESPEnabled = true
    
    for _, obj in pairs(workspace:GetDescendants()) do
        if IsItem(obj) then
            CreateItemESP(obj)
        end
    end
    
    Connections.ItemESPAdded = workspace.DescendantAdded:Connect(function(obj)
        if Settings.ItemESPEnabled and IsItem(obj) then
            wait(0.1)
            CreateItemESP(obj)
        end
    end)
    
    Connections.ItemESPRemoved = workspace.DescendantRemoving:Connect(function(obj)
        if ItemESPObjects[obj] then
            RemoveItemESP(obj)
        end
    end)
    
    local frameCount = 0
    Connections.ItemESPUpdate = RunService.Heartbeat:Connect(function()
        if not Settings.ItemESPEnabled then return end
        frameCount = frameCount + 1
        if frameCount >= 5 then
            frameCount = 0
            UpdateItemESP()
        end
    end)
    
    print("âœ… Item ESP Aktif!")
end

local function DisableItemESP()
    Settings.ItemESPEnabled = false
    
    for item, _ in pairs(ItemESPObjects) do
        RemoveItemESP(item)
    end
    ItemESPObjects = {}
    
    if Connections.ItemESPAdded then Connections.ItemESPAdded:Disconnect() end
    if Connections.ItemESPRemoved then Connections.ItemESPRemoved:Disconnect() end
    if Connections.ItemESPUpdate then Connections.ItemESPUpdate:Disconnect() end
    
    print("âŒ Item ESP KapalÄ±")
end

-- PLAYER ESP SÄ°STEMÄ°
local function CreatePlayerESP(player)
    if not player or PlayerESPObjects[player] or player == Player then return end
    
    local character = player.Character
    if not character then return end
    
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    local rootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoid or not rootPart then return end
    
    pcall(function()
        local billboard = Instance.new("BillboardGui")
        billboard.Name = "PlayerESP_" .. player.Name
        billboard.Size = UDim2.new(0, 200, 0, 60)
        billboard.StudsOffset = Vector3.new(0, 3, 0)
        billboard.AlwaysOnTop = true
        billboard.MaxDistance = 300
        billboard.Adornee = rootPart
        billboard.Parent = rootPart
        
        local frame = Instance.new("Frame")
        frame.Size = UDim2.new(1, 0, 1, 0)
        frame.BackgroundTransparency = 1
        frame.Parent = billboard
        
        local nameLabel = Instance.new("TextLabel")
        nameLabel.Size = UDim2.new(1, 0, 0.35, 0)
        nameLabel.BackgroundTransparency = 1
        nameLabel.Text = player.Name
        nameLabel.TextColor3 = Color3.fromRGB(100, 150, 255)
        nameLabel.TextStrokeTransparency = 0.3
        nameLabel.TextSize = 14
        nameLabel.Font = Enum.Font.GothamBold
        nameLabel.Parent = frame
        
        local healthLabel = Instance.new("TextLabel")
        healthLabel.Size = UDim2.new(1, 0, 0.3, 0)
        healthLabel.Position = UDim2.new(0, 0, 0.35, 0)
        healthLabel.BackgroundTransparency = 1
        healthLabel.Text = "HP: 100/100"
        healthLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
        healthLabel.TextStrokeTransparency = 0.3
        healthLabel.TextSize = 11
        healthLabel.Font = Enum.Font.Gotham
        healthLabel.Parent = frame
        
        local infoLabel = Instance.new("TextLabel")
        infoLabel.Size = UDim2.new(1, 0, 0.35, 0)
        infoLabel.Position = UDim2.new(0, 0, 0.65, 0)
        infoLabel.BackgroundTransparency = 1
        infoLabel.Text = "Player"
        infoLabel.TextColor3 = Color3.fromRGB(200, 200, 255)
        infoLabel.TextStrokeTransparency = 0.3
        infoLabel.TextSize = 10
        infoLabel.Font = Enum.Font.Gotham
        infoLabel.Parent = frame
        
        local highlight = Instance.new("Highlight")
        highlight.Name = "PlayerHighlight"
        highlight.Adornee = character
        highlight.FillColor = Color3.fromRGB(100, 150, 255)
        highlight.FillTransparency = 0.85
        highlight.OutlineColor = Color3.fromRGB(50, 100, 200)
        highlight.OutlineTransparency = 0.2
        highlight.Parent = character
        
        PlayerESPObjects[player] = {
            Billboard = billboard,
            Highlight = highlight,
            NameLabel = nameLabel,
            HealthLabel = healthLabel,
            InfoLabel = infoLabel,
            Character = character,
            Humanoid = humanoid,
            RootPart = rootPart
        }
    end)
end

local function RemovePlayerESP(player)
    if not PlayerESPObjects[player] then return end
    
    pcall(function()
        local data = PlayerESPObjects[player]
        if data.Billboard then data.Billboard:Destroy() end
        if data.Highlight then data.Highlight:Destroy() end
        PlayerESPObjects[player] = nil
    end)
end

local function UpdatePlayerESP()
    if not Settings.PlayerESPEnabled then return end
    
    pcall(function()
        Character = GetCharacter()
        local playerRoot = Character and Character:FindFirstChild("HumanoidRootPart")
        if not playerRoot then return end
        
        for player, data in pairs(PlayerESPObjects) do
            if not player or not data.Character or not data.Character.Parent then
                RemovePlayerESP(player)
            elseif data.Humanoid and data.RootPart then
                local health = math.floor(data.Humanoid.Health)
                local maxHealth = math.floor(data.Humanoid.MaxHealth)
                data.HealthLabel.Text = "HP: " .. health .. "/" .. maxHealth
                
                local healthPercent = health / maxHealth
                if healthPercent > 0.6 then
                    data.HealthLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
                elseif healthPercent > 0.3 then
                    data.HealthLabel.TextColor3 = Color3.fromRGB(255, 255, 100)
                else
                    data.HealthLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
                end
                
                local distance = math.floor((data.RootPart.Position - playerRoot.Position).Magnitude)
                data.InfoLabel.Text = distance .. " studs"
            end
        end
    end)
end

local function EnablePlayerESP()
    Settings.PlayerESPEnabled = true
    
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= Player and player.Character then
            CreatePlayerESP(player)
        end
    end
    
    Connections.PlayerESPAdded = Players.PlayerAdded:Connect(function(player)
        player.CharacterAdded:Connect(function()
            if Settings.PlayerESPEnabled then
                wait(0.5)
                CreatePlayerESP(player)
            end
        end)
    end)
    
    Connections.PlayerESPRemoved = Players.PlayerRemoving:Connect(function(player)
        RemovePlayerESP(player)
    end)
    
    local frameCount = 0
    Connections.PlayerESPUpdate = RunService.Heartbeat:Connect(function()
        if not Settings.PlayerESPEnabled then return end
        frameCount = frameCount + 1
        if frameCount >= 5 then
            frameCount = 0
            UpdatePlayerESP()
        end
    end)
    
    print("âœ… Player ESP Aktif!")
end

local function DisablePlayerESP()
    Settings.PlayerESPEnabled = false
    
    for player, _ in pairs(PlayerESPObjects) do
        RemovePlayerESP(player)
    end
    PlayerESPObjects = {}
    
    if Connections.PlayerESPAdded then Connections.PlayerESPAdded:Disconnect() end
    if Connections.PlayerESPRemoved then Connections.PlayerESPRemoved:Disconnect() end
    if Connections.PlayerESPUpdate then Connections.PlayerESPUpdate:Disconnect() end
    
    print("âŒ Player ESP KapalÄ±")
end

-- KARAKTER DEÄÄ°ÅÄ°MÄ°
Player.CharacterAdded:Connect(function(char)
    Character = char
    HumanoidRootPart = char:WaitForChild("HumanoidRootPart", 10)
    
    if Settings.GodModeEnabled then
        wait(0.5)
        DisableGodMode()
        EnableGodMode()
    end
end)

print("=== PART 3 YÃœKLENDÄ° ===")-- Universal Tool v5.0 - Part 4/7
-- BLACK HOLE GELÄ°ÅTÄ°RMESÄ° + BRING SÄ°STEMLERÄ°

-- SERVÄ°SLER
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

-- DEÄIÅKENLER
local Player = Players.LocalPlayer
local Character = Player.Character or Player.CharacterAdded:Wait()
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")

-- AYARLAR (Ã¶nceki part'lardan devam ediyor)
if not getgenv().Settings then
    getgenv().Settings = {
        BlackHoleEnabled = false,
        PullRadius = 50,
        PullForce = 100
    }
end

if not getgenv().Connections then
    getgenv().Connections = {}
end

if not getgenv().RagdolledNPCs then
    getgenv().RagdolledNPCs = {}
end

local Settings = getgenv().Settings
local Connections = getgenv().Connections
local RagdolledNPCs = getgenv().RagdolledNPCs

-- YARDIMCI FONKSÄ°YONLAR
local function GetCharacter()
    return Player.Character
end

local function IsItem(obj)
    if obj:IsA("Tool") then return true end
    if obj:IsA("BasePart") and not obj.Anchored and obj.Parent ~= Character then
        local validNames = {"item", "object", "pickup", "collectible", "weapon", "gear"}
        local objName = obj.Name:lower()
        for _, name in pairs(validNames) do
            if objName:find(name) then return true end
        end
    end
    return false
end

-- GELÄ°ÅTÄ°RÄ°LMÄ°Å BLACK HOLE SÄ°STEMÄ°
local BlackHolePart = nil
local BlackHoleEffect = nil
local BlackHoleSound = nil
local BlackHoleBeam = nil

local function CreateAdvancedBlackHole()
    -- Black Hole part'Ä± oluÅŸtur
    local blackHole = Instance.new("Part")
    blackHole.Name = "AdvancedBlackHole"
    blackHole.Size = Vector3.new(6, 6, 6)
    blackHole.Shape = Enum.PartType.Ball
    blackHole.Material = Enum.Material.Neon
    blackHole.BrickColor = BrickColor.new("Really black")
    blackHole.Transparency = 0.3
    blackHole.CanCollide = false
    blackHole.Anchored = true
    blackHole.Locked = true
    blackHole.Parent = workspace
    
    -- ParticleEmitter
    local particles = Instance.new("ParticleEmitter")
    particles.Name = "BlackHoleParticles"
    particles.Texture = "rbxassetid://242932562"
    particles.Lifetime = NumberRange.new(1, 2)
    particles.Rate = 100
    particles.Rotation = NumberRange.new(0, 360)
    particles.RotSpeed = NumberRange.new(-100, 100)
    particles.Speed = NumberRange.new(5, 15)
    particles.VelocitySpread = 360
    particles.Size = NumberSequence.new({
        NumberSequenceKeypoint.new(0, 0.5),
        NumberSequenceKeypoint.new(0.5, 1),
        NumberSequenceKeypoint.new(1, 0)
    })
    particles.Transparency = NumberSequence.new({
        NumberSequenceKeypoint.new(0, 0),
        NumberSequenceKeypoint.new(0.5, 0.3),
        NumberSequenceKeypoint.new(1, 1)
    })
    particles.Color = ColorSequence.new(Color3.fromRGB(0, 0, 0), Color3.fromRGB(50, 0, 100))
    particles.Acceleration = Vector3.new(0, -10, 0)
    particles.EmissionDirection = Enum.NormalId.Front
    particles.Parent = blackHole
    
    -- IÅŸÄ±k efekti
    local pointLight = Instance.new("PointLight")
    pointLight.Name = "BlackHoleLight"
    pointLight.Brightness = 10
    pointLight.Range = 50
    pointLight.Color = Color3.fromRGB(100, 0, 200)
    pointLight.Shadows = true
    pointLight.Parent = blackHole
    
    -- Ses efekti
    local sound = Instance.new("Sound")
    sound.Name = "BlackHoleSound"
    sound.SoundId = "rbxassetid://9119048339"
    sound.Volume = 0.7
    sound.Looped = true
    sound.Parent = blackHole
    sound:Play()
    
    -- Beam efekti
    local attachment1 = Instance.new("Attachment")
    attachment1.Name = "BeamAttachment1"
    attachment1.Parent = blackHole
    
    local beam = Instance.new("Beam")
    beam.Name = "BlackHoleBeam"
    beam.FaceCamera = true
    beam.Color = ColorSequence.new(Color3.fromRGB(100, 0, 200), Color3.fromRGB(200, 0, 100))
    beam.Width0 = 2
    beam.Width1 = 2
    beam.Texture = "rbxassetid://446111271"
    beam.TextureSpeed = 2
    beam.Attachment0 = attachment1
    beam.Attachment1 = attachment1
    beam.Parent = blackHole
    
    BlackHolePart = blackHole
    BlackHoleEffect = particles
    BlackHoleSound = sound
    BlackHoleBeam = beam
    
    return blackHole
end

local function EnableAdvancedBlackHole()
    Settings.BlackHoleEnabled = true
    
    Character = GetCharacter()
    if not Character then return end
    
    HumanoidRootPart = Character:FindFirstChild("HumanoidRootPart")
    if not HumanoidRootPart then return end
    
    if not BlackHolePart then
        CreateAdvancedBlackHole()
    end
    
    local offset = HumanoidRootPart.CFrame.LookVector * 15
    BlackHolePart.CFrame = CFrame.new(HumanoidRootPart.Position + offset + Vector3.new(0, 2, 0))
    
    Connections.BlackHoleLoop = RunService.Heartbeat:Connect(function()
        if not Settings.BlackHoleEnabled or not BlackHolePart then return end
        
        pcall(function()
            if HumanoidRootPart and HumanoidRootPart.Parent then
                local targetPos = HumanoidRootPart.Position + (HumanoidRootPart.CFrame.LookVector * 15) + Vector3.new(0, 2, 0)
                BlackHolePart.CFrame = BlackHolePart.CFrame:Lerp(CFrame.new(targetPos), 0.1)
            end
            
            local blackHolePos = BlackHolePart.Position
            local radius = Settings.PullRadius
            local force = Settings.PullForce * 2
            
            -- NPC'leri Ã§ek
            for _, npc in pairs(workspace:GetChildren()) do
                if npc:IsA("Model") and npc ~= Character then
                    local humanoid = npc:FindFirstChildOfClass("Humanoid")
                    local rootPart = npc:FindFirstChild("HumanoidRootPart") or 
                                    npc:FindFirstChild("Torso") or 
                                    npc:FindFirstChild("UpperTorso")
                    
                    if humanoid and rootPart and rootPart.Parent then
                        local distance = (rootPart.Position - blackHolePos).Magnitude
                        
                        if distance <= radius then
                            local pullStrength = force * (1 - (distance / radius))
                            local direction = (blackHolePos - rootPart.Position).Unit
                            
                            rootPart.Velocity = rootPart.Velocity + (direction * pullStrength)
                            
                            local angularForce = Vector3.new(
                                math.random(-50, 50),
                                math.random(100, 300),
                                math.random(-50, 50)
                            )
                            
                            rootPart.RotVelocity = rootPart.RotVelocity + angularForce * 0.1
                            
                            if distance < 10 and not RagdolledNPCs[npc] then
                                for _, child in pairs(npc:GetDescendants()) do
                                    if child:IsA("Motor6D") then
                                        child.Enabled = false
                                    end
                                end
                                
                                humanoid.PlatformStand = true
                                humanoid.AutoRotate = false
                                
                                RagdolledNPCs[npc] = {
                                    Humanoid = humanoid,
                                    IsBlackHole = true
                                }
                            end
                        end
                    end
                end
            end
            
            -- EÅŸyalarÄ± Ã§ek
            for _, obj in pairs(workspace:GetDescendants()) do
                if obj:IsA("BasePart") and not obj.Anchored and obj ~= BlackHolePart and obj.Parent then
                    local distance = (obj.Position - blackHolePos).Magnitude
                    
                    if distance <= radius and distance > 3 then
                        local pullStrength = force * 0.5 * (1 - (distance / radius))
                        local direction = (blackHolePos - obj.Position).Unit
                        
                        obj.Velocity = obj.Velocity + (direction * pullStrength)
                        
                        obj.RotVelocity = obj.RotVelocity + Vector3.new(
                            math.random(-100, 100),
                            math.random(-100, 100),
                            math.random(-100, 100)
                        ) * 0.05
                        
                        if distance < 5 then
                            obj.CFrame = obj.CFrame:Lerp(BlackHolePart.CFrame, 0.1)
                        end
                    end
                end
            end
        end)
    end)
    
    print("ğŸŒ€ GeliÅŸmiÅŸ Black Hole Aktif!")
end

local function DisableAdvancedBlackHole()
    Settings.BlackHoleEnabled = false
    
    if BlackHolePart then
        BlackHolePart:Destroy()
        BlackHolePart = nil
    end
    
    BlackHoleEffect = nil
    BlackHoleSound = nil
    BlackHoleBeam = nil
    
    if Connections.BlackHoleLoop then 
        Connections.BlackHoleLoop:Disconnect() 
        Connections.BlackHoleLoop = nil
    end
    
    for model, data in pairs(RagdolledNPCs) do
        if data.IsBlackHole and data.Humanoid and data.Humanoid.Parent then
            data.Humanoid.PlatformStand = false
            data.Humanoid.AutoRotate = true
            
            for _, child in pairs(model:GetDescendants()) do
                if child:IsA("Motor6D") then
                    child.Enabled = true
                end
            end
        end
    end
    
    local newRagdolledNPCs = {}
    for model, data in pairs(RagdolledNPCs) do
        if not data.IsBlackHole then
            newRagdolledNPCs[model] = data
        end
    end
    RagdolledNPCs = newRagdolledNPCs
    
    print("âŒ Black Hole KapalÄ±")
end

-- BRING FONKSÄ°YONLARI
local function BringAllNPCs()
    Character = GetCharacter()
    if not Character then return end
    
    HumanoidRootPart = Character:FindFirstChild("HumanoidRootPart")
    if not HumanoidRootPart then return end
    
    local charPos = HumanoidRootPart.Position
    local frontDir = HumanoidRootPart.CFrame.LookVector
    
    local count = 0
    for _, npc in pairs(workspace:GetChildren()) do
        if npc:IsA("Model") and npc ~= Character then
            local humanoid = npc:FindFirstChildOfClass("Humanoid")
            local rootPart = npc:FindFirstChild("HumanoidRootPart")
            
            if humanoid and rootPart then
                local row = math.floor(count / 3)
                local col = count % 3
                
                local angle = col * 30 - 30
                local radians = math.rad(angle)
                local distance = 8 + (row * 4)
                
                local offset = Vector3.new(
                    math.sin(radians) * distance,
                    2,
                    math.cos(radians) * distance
                )
                
                local targetPos = charPos + (frontDir * offset.Z) + 
                                 (HumanoidRootPart.CFrame.RightVector * offset.X) + 
                                 Vector3.new(0, offset.Y, 0)
                
                rootPart.CFrame = CFrame.new(targetPos)
                rootPart.Velocity = Vector3.new(0, 0, 0)
                
                count = count + 1
                
                if count % 5 == 0 then
                    task.wait()
                end
            end
        end
    end
    
    print("âœ… " .. count .. " NPC getirildi!")
end

local function BringAllItems()
    Character = GetCharacter()
    if not Character then return end
    
    HumanoidRootPart = Character:FindFirstChild("HumanoidRootPart")
    if not HumanoidRootPart then return end
    
    local charPos = HumanoidRootPart.Position
    local count = 0
    
    for _, obj in pairs(workspace:GetDescendants()) do
        if IsItem(obj) then
            if obj:IsA("Tool") then
                local handle = obj:FindFirstChild("Handle")
                if handle then
                    local targetPos = charPos + Vector3.new(
                        math.random(-5, 5),
                        math.random(3, 8),
                        math.random(-5, 5)
                    )
                    
                    handle.CFrame = CFrame.new(targetPos)
                    count = count + 1
                end
            elseif obj:IsA("BasePart") and not obj.Anchored then
                local targetPos = charPos + Vector3.new(
                    math.random(-5, 5),
                    math.random(3, 8),
                    math.random(-5, 5)
                )
                
                obj.CFrame = CFrame.new(targetPos)
                count = count + 1
            end
            
            if count % 10 == 0 then
                task.wait()
            end
        end
    end
    
    print("âœ… " .. count .. " eÅŸya getirildi!")
end

local function BringAllPlayers()
    Character = GetCharacter()
    if not Character then return end
    
    HumanoidRootPart = Character:FindFirstChild("HumanoidRootPart")
    if not HumanoidRootPart then return end
    
    local charPos = HumanoidRootPart.Position
    local frontDir = HumanoidRootPart.CFrame.LookVector
    
    local count = 0
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= Player and player.Character then
            local char = player.Character
            local rootPart = char:FindFirstChild("HumanoidRootPart")
            
            if rootPart then
                local row = math.floor(count / 2)
                local col = count % 2
                
                local offset = Vector3.new(
                    (col - 0.5) * 6,
                    0,
                    5 + (row * 4)
                )
                
                local targetPos = charPos + (frontDir * offset.Z) + 
                                 (HumanoidRootPart.CFrame.RightVector * offset.X)
                
                rootPart.CFrame = CFrame.new(targetPos)
                rootPart.Velocity = Vector3.new(0, 0, 0)
                
                count = count + 1
                task.wait(0.1)
            end
        end
    end
    
    print("âœ… " .. count .. " oyuncu getirildi!")
end

local function BringAllCars()
    Character = GetCharacter()
    if not Character then return end
    
    HumanoidRootPart = Character:FindFirstChild("HumanoidRootPart")
    if not HumanoidRootPart then return end
    
    local charPos = HumanoidRootPart.Position
    local frontDir = HumanoidRootPart.CFrame.LookVector
    
    local count = 0
    for _, obj in pairs(workspace:GetChildren()) do
        if obj:IsA("Model") then
            local isCar = false
            local carName = obj.Name:lower()
            local carKeywords = {"car", "vehicle", "truck", "jeep", "bus", "van", "motor", "bike", "cycle", "atv", "buggy"}
            
            for _, keyword in pairs(carKeywords) do
                if carName:find(keyword) then
                    isCar = true
                    break
                end
            end
            
            if not isCar then
                local wheelCount = 0
                for _, part in pairs(obj:GetDescendants()) do
                    if part.Name:lower():find("wheel") or part.Name:lower():find("tire") then
                        wheelCount = wheelCount + 1
                    end
                end
                if wheelCount >= 2 then
                    isCar = true
                end
            end
            
            if isCar then
                local primaryPart = obj.PrimaryPart or obj:FindFirstChildWhichIsA("BasePart")
                
                if primaryPart then
                    local row = math.floor(count / 2)
                    local col = count % 2
                    
                    local offset = Vector3.new(
                        (col - 0.5) * 10,
                        0,
                        8 + (row * 8)
                    )
                    
                    local targetPos = charPos + (frontDir * offset.Z) + 
                                     (HumanoidRootPart.CFrame.RightVector * offset.X)
                    
                    for _, part in pairs(obj:GetDescendants()) do
                        if part:IsA("BasePart") then
                            local relativePos = part.Position - primaryPart.Position
                            part.CFrame = CFrame.new(targetPos + relativePos)
                            part.Velocity = Vector3.new(0, 0, 0)
                        end
                    end
                    
                    count = count + 1
                    task.wait(0.2)
                end
            end
        end
    end
    
    print("âœ… " .. count .. " araba getirildi!")
end

local function BringAllTools()
    Character = GetCharacter()
    if not Character then return end
    
    HumanoidRootPart = Character:FindFirstChild("HumanoidRootPart")
    if not HumanoidRootPart then return end
    
    local charPos = HumanoidRootPart.Position
    local count = 0
    local tools = {}
    
    for _, obj in pairs(workspace:GetDescendants()) do
        if obj:IsA("Tool") then
            table.insert(tools, obj)
        end
    end
    
    for i, tool in ipairs(tools) do
        local handle = tool:FindFirstChild("Handle")
        if handle then
            local angle = (i / #tools) * math.pi * 2
            local radius = 8
            local height = 3
            
            local offset = Vector3.new(
                math.sin(angle) * radius,
                height + (i % 3) * 2,
                math.cos(angle) * radius
            )
            
            local targetPos = charPos + offset
            handle.CFrame = CFrame.new(targetPos)
            
            count = count + 1
            
            if count % 5 == 0 then
                task.wait()
            end
        end
    end
    
    print("âœ… " .. count .. " araÃ§ getirildi!")
end

-- BRING MENU
local function CreateBringMenu()
    local bringMenu = Instance.new("ScreenGui")
    bringMenu.Name = "BringSelectionMenu"
    bringMenu.ResetOnSpawn = false
    bringMenu.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    
    local success, err = pcall(function()
        bringMenu.Parent = game:GetService("CoreGui")
    end)
    
    if not success then
        bringMenu.Parent = Player:WaitForChild("PlayerGui")
    end
    
    local mainFrame = Instance.new("Frame")
    mainFrame.Name = "MainFrame"
    mainFrame.Size = UDim2.new(0, 300, 0, 400)
    mainFrame.Position = UDim2.new(0.5, -150, 0.5, -200)
    mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 45)
    mainFrame.BorderSizePixel = 0
    mainFrame.Active = true
    mainFrame.Draggable = true
    mainFrame.Parent = bringMenu
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 12)
    corner.Parent = mainFrame
    
    local stroke = Instance.new("UIStroke")
    stroke.Color = Color3.fromRGB(100, 50, 150)
    stroke.Thickness = 2
    stroke.Parent = mainFrame
    
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, 0, 0, 50)
    title.BackgroundColor3 = Color3.fromRGB(50, 30, 70)
    title.BorderSizePixel = 0
    title.Text = "ğŸ”§ BRING MENU"
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.TextSize = 20
    title.Font = Enum.Font.GothamBold
    title.Parent = mainFrame
    
    local titleCorner = Instance.new("UICorner")
    titleCorner.CornerRadius = UDim.new(0, 12)
    titleCorner.Parent = title
    
    local closeBtn = Instance.new("TextButton")
    closeBtn.Size = UDim2.new(0, 40, 0, 40)
    closeBtn.Position = UDim2.new(1, -45, 0, 5)
    closeBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
    closeBtn.Text = "X"
    closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    closeBtn.TextSize = 18
    closeBtn.Font = Enum.Font.GothamBold
    closeBtn.Parent = title
    
    local btnCorner = Instance.new("UICorner")
    btnCorner.CornerRadius = UDim.new(0, 8)
    btnCorner.Parent = closeBtn
    
    closeBtn.MouseButton1Click:Connect(function()
        bringMenu:Destroy()
    end)
    
    local buttonList = Instance.new("ScrollingFrame")
    buttonList.Name = "ButtonList"
    buttonList.Size = UDim2.new(1, -20, 1, -70)
    buttonList.Position = UDim2.new(0, 10, 0, 60)
    buttonList.BackgroundTransparency = 1
    buttonList.ScrollBarThickness = 4
    buttonList.ScrollBarImageColor3 = Color3.fromRGB(100, 80, 150)
    buttonList.CanvasSize = UDim2.new(0, 0, 0, 500)
    buttonList.Parent = mainFrame
    
    local buttonLayout = Instance.new("UIListLayout")
    buttonLayout.Padding = UDim.new(0, 10)
    buttonLayout.SortOrder = Enum.SortOrder.LayoutOrder
    buttonLayout.Parent = buttonList
    
    local bringButtons = {
        {Name = "ğŸ‘¥ Bring All Players", Color = Color3.fromRGB(50, 150, 255), Func = BringAllPlayers},
        {Name = "ğŸ’€ Bring All NPCs", Color = Color3.fromRGB(255, 100, 100), Func = BringAllNPCs},
        {Name = "ğŸš— Bring All Cars", Color = Color3.fromRGB(255, 200, 50), Func = BringAllCars},
        {Name = "ğŸ› ï¸ Bring All Tools", Color = Color3.fromRGB(100, 255, 100), Func = BringAllTools},
        {Name = "ğŸ“¦ Bring All Items", Color = Color3.fromRGB(200, 100, 255), Func = BringAllItems},
        {Name = "ğŸŒ€ Toggle Black Hole", Color = Color3.fromRGB(150, 50, 200), Func = function()
            if Settings.BlackHoleEnabled then
                DisableAdvancedBlackHole()
            else
                EnableAdvancedBlackHole()
            end
        end}
    }
    
    for i, btnData in ipairs(bringButtons) do
        local button = Instance.new("TextButton")
        button.Size = UDim2.new(1, 0, 0, 50)
        button.BackgroundColor3 = btnData.Color
        button.Text = btnData.Name
        button.TextColor3 = Color3.fromRGB(255, 255, 255)
        button.TextSize = 16
        button.Font = Enum.Font.GothamSemibold
        button.LayoutOrder = i
        button.Parent = buttonList
        
        local btnCorner2 = Instance.new("UICorner")
        btnCorner2.CornerRadius = UDim.new(0, 8)
        btnCorner2.Parent = button
        
        button.MouseButton1Click:Connect(function()
            btnData.Func()
        end)
    end
    
    buttonLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        buttonList.CanvasSize = UDim2.new(0, 0, 0, buttonLayout.AbsoluteContentSize.Y + 10)
    end)
    
    return bringMenu
end

local function OpenBringMenu()
    local oldMenu = nil
    pcall(function()
        oldMenu = game:GetService("CoreGui"):FindFirstChild("BringSelectionMenu")
    end)
    
    if not oldMenu then
        pcall(function()
            oldMenu = Player.PlayerGui:FindFirstChild("BringSelectionMenu")
        end)
    end
    
    if oldMenu then oldMenu:Destroy() end
    
    CreateBringMenu()
end

-- KARAKTER DEÄÄ°ÅÄ°KLÄ°ÄÄ°
Player.CharacterAdded:Connect(function(char)
    Character = char
    HumanoidRootPart = char:WaitForChild("HumanoidRootPart", 10)
    
    if Settings.BlackHoleEnabled then
        task.wait(0.5)
        DisableAdvancedBlackHole()
        EnableAdvancedBlackHole()
    end
end)

-- EXPORT
getgenv().BlackHoleFunctions = {
    Enable = EnableAdvancedBlackHole,
    Disable = DisableAdvancedBlackHole,
    OpenBringMenu = OpenBringMenu,
    BringAllNPCs = BringAllNPCs,
    BringAllItems = BringAllItems,
    BringAllPlayers = BringAllPlayers,
    BringAllCars = BringAllCars,
    BringAllTools = BringAllTools
}

print("=== PART 4 YÃœKLENDÄ° ===")
print("âœ… Black Hole ve Bring sistemleri hazÄ±r!")-- Universal Tool v5.0 - Part 5/7 (DÃœZELTME)
-- FULLBRIGHT + NO CLIP GELÄ°ÅTÄ°RMESÄ° + GUI DÃœZELTMELERÄ°

-- GLOBAL DEÄÄ°ÅKENLER (Eksik olanlar eklendi)
_G.UniversalTool = _G.UniversalTool or {}
local Player = game:GetService("Players").LocalPlayer
local Character = Player.Character or Player.CharacterAdded:Wait()
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")
local Camera = workspace.CurrentCamera
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

-- Settings tablosu (eÄŸer yoksa oluÅŸtur)
if not _G.UniversalTool.Settings then
    _G.UniversalTool.Settings = {
        FlyEnabled = false,
        NoClipEnabled = false,
        GodModeEnabled = false,
        ESPEnabled = false,
        BlackHoleEnabled = false,
        FlingEnabled = false,
        AutoRagdollEnabled = false
    }
end

local Settings = _G.UniversalTool.Settings

-- Connections tablosu (eÄŸer yoksa oluÅŸtur)
if not _G.UniversalTool.Connections then
    _G.UniversalTool.Connections = {}
end

local Connections = _G.UniversalTool.Connections

-- NoClipParts tablosu
local NoClipParts = {}

-- GetCharacter fonksiyonu (eÄŸer yoksa oluÅŸtur)
local function GetCharacter()
    return Player.Character or Player.CharacterAdded:Wait()
end

-- FULLBRIGHT SÄ°STEMÄ°
local OriginalLightingSettings = {}
local FullBrightEnabled = false

local function EnableFullBright()
    if FullBrightEnabled then return end
    
    FullBrightEnabled = true
    
    -- Orijinal ayarlarÄ± kaydet
    local lighting = game:GetService("Lighting")
    OriginalLightingSettings = {
        Ambient = lighting.Ambient,
        Brightness = lighting.Brightness,
        GlobalShadows = lighting.GlobalShadows,
        OutdoorAmbient = lighting.OutdoorAmbient,
        ClockTime = lighting.ClockTime,
        FogColor = lighting.FogColor,
        FogEnd = lighting.FogEnd,
        FogStart = lighting.FogStart,
        GeographicLatitude = lighting.GeographicLatitude,
        TimeOfDay = lighting.TimeOfDay
    }
    
    -- Fullbright ayarlarÄ±nÄ± uygula
    lighting.Ambient = Color3.fromRGB(255, 255, 255)
    lighting.Brightness = 2
    lighting.GlobalShadows = false
    lighting.OutdoorAmbient = Color3.fromRGB(255, 255, 255)
    lighting.ClockTime = 14
    lighting.FogColor = Color3.fromRGB(255, 255, 255)
    lighting.FogEnd = 1000000
    lighting.FogStart = 0
    lighting.GeographicLatitude = 0
    lighting.TimeOfDay = "14:00:00"
    
    -- Sky'Ä± kaldÄ±r
    local sky = lighting:FindFirstChildOfClass("Sky")
    if sky then
        sky:Destroy()
    end
    
    -- Atmosphere'Ã¼ kaldÄ±r
    local atmosphere = lighting:FindFirstChildOfClass("Atmosphere")
    if atmosphere then
        atmosphere:Destroy()
    end
    
    -- TÃ¼m Ä±ÅŸÄ±klarÄ± maksimum yap
    for _, light in pairs(lighting:GetChildren()) do
        if light:IsA("PointLight") or light:IsA("SpotLight") or light:IsA("SurfaceLight") then
            light.Brightness = 10
            light.Range = 1000
            light.Enabled = true
        end
    end
    
    -- Yeni eklenen Ä±ÅŸÄ±klarÄ± da ayarla
    Connections.FullBrightAdded = lighting.ChildAdded:Connect(function(child)
        wait(0.1)
        if child:IsA("PointLight") or child:IsA("SpotLight") or child:IsA("SurfaceLight") then
            child.Brightness = 10
            child.Range = 1000
            child.Enabled = true
        elseif child:IsA("Sky") or child:IsA("Atmosphere") then
            child:Destroy()
        end
    end)
    
    -- Ekran parlaklÄ±ÄŸÄ± efekti
    local bloom = Instance.new("BloomEffect")
    bloom.Name = "FullBrightBloom"
    bloom.Intensity = 0.5
    bloom.Size = 24
    bloom.Threshold = 0.9
    bloom.Parent = lighting
    
    local colorCorrection = Instance.new("ColorCorrectionEffect")
    colorCorrection.Name = "FullBrightColorCorrection"
    colorCorrection.Brightness = 0.2
    colorCorrection.Contrast = 0.2
    colorCorrection.Saturation = 0.1
    colorCorrection.Parent = lighting
    
    -- Fullbright gÃ¶stergesi
    pcall(function()
        local char = GetCharacter()
        if char then
            local rootPart = char:FindFirstChild("HumanoidRootPart")
            if rootPart then
                local indicator = Instance.new("BillboardGui")
                indicator.Name = "FullBrightIndicator"
                indicator.Size = UDim2.new(0, 120, 0, 40)
                indicator.StudsOffset = Vector3.new(0, 3.5, 0)
                indicator.AlwaysOnTop = true
                indicator.Adornee = rootPart
                indicator.Parent = rootPart
                
                local label = Instance.new("TextLabel")
                label.Size = UDim2.new(1, 0, 1, 0)
                label.BackgroundTransparency = 1
                label.Text = "â˜€ï¸ FULLBRIGHT"
                label.TextColor3 = Color3.fromRGB(255, 255, 100)
                label.TextSize = 16
                label.Font = Enum.Font.GothamBold
                label.Parent = indicator
            end
        end
    end)
    
    print("â˜€ï¸ Fullbright Aktif! - TÃ¼m harita aydÄ±nlandÄ±")
end

local function DisableFullBright()
    if not FullBrightEnabled then return end
    
    FullBrightEnabled = false
    
    -- Orijinal ayarlarÄ± geri yÃ¼kle
    local lighting = game:GetService("Lighting")
    
    for setting, value in pairs(OriginalLightingSettings) do
        pcall(function()
            lighting[setting] = value
        end)
    end
    
    -- Efektleri temizle
    local bloom = lighting:FindFirstChild("FullBrightBloom")
    if bloom then bloom:Destroy() end
    
    local colorCorrection = lighting:FindFirstChild("FullBrightColorCorrection")
    if colorCorrection then colorCorrection:Destroy() end
    
    -- BaÄŸlantÄ±yÄ± temizle
    if Connections.FullBrightAdded then
        Connections.FullBrightAdded:Disconnect()
        Connections.FullBrightAdded = nil
    end
    
    -- GÃ¶stergeleri temizle
    pcall(function()
        local char = GetCharacter()
        if char then
            local rootPart = char:FindFirstChild("HumanoidRootPart")
            if rootPart then
                local indicator = rootPart:FindFirstChild("FullBrightIndicator")
                if indicator then indicator:Destroy() end
            end
        end
    end)
    
    print("âŒ Fullbright KapalÄ±")
end

-- GELÄ°ÅTÄ°RÄ°LMÄ°Å NO CLIP SÄ°STEMÄ°
local function EnableEnhancedNoClip()
    Settings.NoClipEnabled = true
    
    local char = GetCharacter()
    if not char then return end
    
    local humanoid = char:FindFirstChildOfClass("Humanoid")
    if humanoid then
        humanoid:ChangeState(Enum.HumanoidStateType.Physics)
    end
    
    -- TÃ¼m parÃ§alarÄ± bul ve collision'larÄ± kapat
    NoClipParts = {}
    
    local function DisableCollision(part)
        if part:IsA("BasePart") and part.CanCollide then
            table.insert(NoClipParts, {
                Part = part,
                OriginalCanCollide = part.CanCollide,
                OriginalTransparency = part.Transparency
            })
            part.CanCollide = false
            part.Transparency = math.min(part.Transparency + 0.3, 0.9)
            
            -- NoClip Ä±ÅŸÄ±ÄŸÄ±
            if not part:FindFirstChild("EnhancedNoClipLight") then
                local light = Instance.new("PointLight")
                light.Name = "EnhancedNoClipLight"
                light.Brightness = 0.5
                light.Range = 6
                light.Color = Color3.fromRGB(100, 200, 255)
                light.Parent = part
            end
        end
    end
    
    -- Mevcut parÃ§alar
    for _, part in pairs(char:GetDescendants()) do
        DisableCollision(part)
    end
    
    -- Yeni eklenen parÃ§alar
    Connections.EnhancedNoClipAdded = char.DescendantAdded:Connect(function(part)
        wait(0.1)
        DisableCollision(part)
    end)
    
    -- NoClip hareket kontrolÃ¼
    local noClipSpeed = 50
    local noClipKeys = {
        Forward = false,
        Backward = false,
        Left = false,
        Right = false,
        Up = false,
        Down = false
    }
    
    -- Klavye kontrolleri
    Connections.NoClipKeyDown = UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if gameProcessed then return end
        
        if input.KeyCode == Enum.KeyCode.W then noClipKeys.Forward = true end
        if input.KeyCode == Enum.KeyCode.S then noClipKeys.Backward = true end
        if input.KeyCode == Enum.KeyCode.A then noClipKeys.Left = true end
        if input.KeyCode == Enum.KeyCode.D then noClipKeys.Right = true end
        if input.KeyCode == Enum.KeyCode.Space then noClipKeys.Up = true end
        if input.KeyCode == Enum.KeyCode.LeftShift then noClipKeys.Down = true end
        
        -- HÄ±z kontrolÃ¼
        if input.KeyCode == Enum.KeyCode.E then
            noClipSpeed = math.min(noClipSpeed + 20, 200)
        end
        if input.KeyCode == Enum.KeyCode.Q then
            noClipSpeed = math.max(noClipSpeed - 20, 10)
        end
    end)
    
    Connections.NoClipKeyUp = UserInputService.InputEnded:Connect(function(input)
        if input.KeyCode == Enum.KeyCode.W then noClipKeys.Forward = false end
        if input.KeyCode == Enum.KeyCode.S then noClipKeys.Backward = false end
        if input.KeyCode == Enum.KeyCode.A then noClipKeys.Left = false end
        if input.KeyCode == Enum.KeyCode.D then noClipKeys.Right = false end
        if input.KeyCode == Enum.KeyCode.Space then noClipKeys.Up = false end
        if input.KeyCode == Enum.KeyCode.LeftShift then noClipKeys.Down = false end
    end)
    
    -- NoClip hareket loop'u
    Connections.NoClipLoop = RunService.Heartbeat:Connect(function()
        if not Settings.NoClipEnabled then return end
        
        local currentChar = GetCharacter()
        if not currentChar then return end
        
        local rootPart = currentChar:FindFirstChild("HumanoidRootPart")
        if not rootPart then return end
        
        -- Hareket vektÃ¶rÃ¼
        local moveVector = Vector3.new(0, 0, 0)
        
        if noClipKeys.Forward then moveVector = moveVector + Camera.CFrame.LookVector end
        if noClipKeys.Backward then moveVector = moveVector - Camera.CFrame.LookVector end
        if noClipKeys.Left then moveVector = moveVector - Camera.CFrame.RightVector end
        if noClipKeys.Right then moveVector = moveVector + Camera.CFrame.RightVector end
        if noClipKeys.Up then moveVector = moveVector + Vector3.new(0, 1, 0) end
        if noClipKeys.Down then moveVector = moveVector - Vector3.new(0, 1, 0) end
        
        -- Hareketi uygula
        if moveVector.Magnitude > 0 then
            rootPart.CFrame = rootPart.CFrame + (moveVector.Unit * noClipSpeed * 0.05)
        end
        
        -- Collision kontrolÃ¼
        for _, data in pairs(NoClipParts) do
            if data.Part and data.Part.Parent then
                if data.Part.CanCollide then
                    data.Part.CanCollide = false
                end
            end
        end
    end)
    
    -- NoClip gÃ¶stergesi
    pcall(function()
        local rootPart = char:FindFirstChild("HumanoidRootPart")
        if rootPart then
            local indicator = Instance.new("BillboardGui")
            indicator.Name = "EnhancedNoClipIndicator"
            indicator.Size = UDim2.new(0, 150, 0, 60)
            indicator.StudsOffset = Vector3.new(0, 4, 0)
            indicator.AlwaysOnTop = true
            indicator.Adornee = rootPart
            indicator.Parent = rootPart
            
            local label = Instance.new("TextLabel")
            label.Size = UDim2.new(1, 0, 0.6, 0)
            label.BackgroundTransparency = 1
            label.Text = "ğŸš€ ENHANCED NO CLIP"
            label.TextColor3 = Color3.fromRGB(100, 200, 255)
            label.TextSize = 16
            label.Font = Enum.Font.GothamBold
            label.Parent = indicator
            
            local speedLabel = Instance.new("TextLabel")
            speedLabel.Size = UDim2.new(1, 0, 0.4, 0)
            speedLabel.Position = UDim2.new(0, 0, 0.6, 0)
            speedLabel.BackgroundTransparency = 1
            speedLabel.Text = "Speed: " .. noClipSpeed
            speedLabel.TextColor3 = Color3.fromRGB(200, 200, 255)
            speedLabel.TextSize = 12
            speedLabel.Font = Enum.Font.Gotham
            speedLabel.Parent = indicator
            
            -- HÄ±z gÃ¼ncelleme
            spawn(function()
                while Settings.NoClipEnabled do
                    speedLabel.Text = "Speed: " .. noClipSpeed
                    wait(0.5)
                end
            end)
        end
    end)
    
    print("ğŸš€ GeliÅŸmiÅŸ No Clip Aktif!")
    print("   â€¢ WASD + Space/Shift ile hareket")
    print("   â€¢ E/Q ile hÄ±z kontrolÃ¼")
end

local function DisableEnhancedNoClip()
    Settings.NoClipEnabled = false
    
    -- Collision'larÄ± geri yÃ¼kle
    for _, data in pairs(NoClipParts) do
        if data.Part and data.Part.Parent then
            pcall(function()
                data.Part.CanCollide = data.OriginalCanCollide
                data.Part.Transparency = data.OriginalTransparency
                
                local light = data.Part:FindFirstChild("EnhancedNoClipLight")
                if light then light:Destroy() end
            end)
        end
    end
    
    NoClipParts = {}
    
    -- BaÄŸlantÄ±larÄ± temizle
    if Connections.EnhancedNoClipAdded then 
        Connections.EnhancedNoClipAdded:Disconnect()
        Connections.EnhancedNoClipAdded = nil
    end
    if Connections.NoClipKeyDown then 
        Connections.NoClipKeyDown:Disconnect()
        Connections.NoClipKeyDown = nil
    end
    if Connections.NoClipKeyUp then 
        Connections.NoClipKeyUp:Disconnect()
        Connections.NoClipKeyUp = nil
    end
    if Connections.NoClipLoop then 
        Connections.NoClipLoop:Disconnect()
        Connections.NoClipLoop = nil
    end
    
    -- GÃ¶stergeleri temizle
    pcall(function()
        local char = GetCharacter()
        if char then
            local rootPart = char:FindFirstChild("HumanoidRootPart")
            if rootPart then
                local indicator = rootPart:FindFirstChild("EnhancedNoClipIndicator")
                if indicator then indicator:Destroy() end
            end
        end
    end)
    
    -- Humanoid state'i geri yÃ¼kle
    local humanoid = Character and Character:FindFirstChildOfClass("Humanoid")
    if humanoid then
        humanoid:ChangeState(Enum.HumanoidStateType.Running)
    end
    
    print("âŒ GeliÅŸmiÅŸ No Clip KapalÄ±")
end

-- FONKSÄ°YONLARI GLOBAL YAPTIK
_G.UniversalTool.EnableFullBright = EnableFullBright
_G.UniversalTool.DisableFullBright = DisableFullBright
_G.UniversalTool.EnableEnhancedNoClip = EnableEnhancedNoClip
_G.UniversalTool.DisableEnhancedNoClip = DisableEnhancedNoClip
_G.UniversalTool.FullBrightEnabled = function() return FullBrightEnabled end

-- KARAKTER DEÄÄ°ÅÄ°KLÄ°ÄÄ°
Player.CharacterAdded:Connect(function(char)
    Character = char
    HumanoidRootPart = char:WaitForChild("HumanoidRootPart", 10)
    
    -- NoClip aktifse yeniden baÄŸla
    if Settings.NoClipEnabled then
        wait(0.5)
        DisableEnhancedNoClip()
        EnableEnhancedNoClip()
    end
    
    -- Fullbright gÃ¶stergesini yeniden baÄŸla
    if FullBrightEnabled then
        wait(0.5)
        EnableFullBright()
    end
end)

print("âœ… Part 5/7 YÃ¼klendi - Fullbright + Enhanced NoClip")-- Universal Tool v5.0 - Part 6/7
-- AUTO RAGDOLL GELÄ°ÅTÄ°RMESÄ° + NPC TESPÄ°T SÄ°STEMÄ°

-- SERVÄ°SLER VE DEÄÄ°ÅKENLER
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Player = Players.LocalPlayer
local Character = Player.Character or Player.CharacterAdded:Wait()
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")

-- GLOBAL DEÄÄ°ÅKENLER (diÄŸer partlardan gelecek)
Settings = Settings or {
    AutoRagdollEnabled = false,
    RagdollDetectionRange = 50,
    FlingEnabled = false,
    BlackHoleEnabled = false
}

Connections = Connections or {}
RagdolledNPCs = RagdolledNPCs or {}
BlackHolePart = BlackHolePart or nil

-- GELÄ°ÅMÄ°Å NPC TESPÄ°T SÄ°STEMÄ° (WALK FLING Ä°LE UYUMLU)
local DangerousNPCs = {}
local NPCScanCooldown = 0
local LastScanTime = 0

-- KARAKTER ALMA FONKSÄ°YONU
local function GetCharacter()
    return Player.Character
end

-- TABLE.SIZE FONKSÄ°YONU (eksikti)
local function tableSize(tbl)
    local count = 0
    for _ in pairs(tbl) do
        count = count + 1
    end
    return count
end

-- TEHLÄ°KELÄ° NPC TESPÄ°T FONKSÄ°YONU (GELÄ°ÅMÄ°Å)
local function IsNPCTrulyDangerous(model, playerPosition)
    if not model or not model:IsA("Model") then return false, "Not a model" end
    
    -- Oyuncu kontrolÃ¼
    for _, player in pairs(Players:GetPlayers()) do
        if player.Character == model then
            return false, "Player character"
        end
    end
    
    local humanoid = model:FindFirstChildOfClass("Humanoid")
    if not humanoid then return false, "No humanoid" end
    
    -- Root part kontrolÃ¼
    local rootPart = model:FindFirstChild("HumanoidRootPart") or 
                    model:FindFirstChild("Torso") or 
                    model:FindFirstChild("UpperTorso")
    if not rootPart then return false, "No root part" end
    
    -- Ä°sim analizi (geniÅŸletilmiÅŸ)
    local modelName = model.Name:lower()
    local modelDisplayName = (model:GetAttribute("DisplayName") or ""):lower()
    
    -- GÃœVENLÄ° NPC LÄ°STESÄ° (daha kapsamlÄ±)
    local safePatterns = {
        "shop", "vendor", "merchant", "trader", "seller", "buyer",
        "quest", "npc", "friendly", "ally", "helper", "assistant",
        "guide", "civilian", "villager", "citizen", "townsfolk",
        "guard", "soldier", "knight", "paladin",
        "pet", "animal", "creature", "bird", "fish", "rabbit",
        "deer", "horse", "cow", "pig", "chicken", "sheep",
        "trainer", "teacher", "master", "sensei", "mentor",
        "priest", "monk", "cleric", "healer", "doctor", "nurse",
        "blacksmith", "farmer", "fisherman", "miner", "lumberjack",
        "bartender", "chef", "cook", "waiter", "waitress",
        "child", "baby", "kid", "elder", "old", "grandpa", "grandma"
    }
    
    -- TEHLÄ°KELÄ° NPC LÄ°STESÄ° (daha kapsamlÄ±)
    local dangerPatterns = {
        "enemy", "hostile", "aggressive", "attack", "attacker",
        "monster", "creep", "mob", "fiend", "beast", "brute",
        "demon", "devil", "ghost", "spirit", "phantom", "specter",
        "zombie", "skeleton", "undead", "vampire", "werewolf",
        "goblin", "orc", "troll", "ogre", "giant", "cyclops",
        "dragon", "wyvern", "griffin", "basilisk", "hydra",
        "spider", "scorpion", "snake", "serpent", "worm",
        "slime", "ooze", "blob", "gelatinous",
        "bandit", "pirate", "raider", "thief", "rogue", "assassin",
        "killer", "murderer", "hunter", "predator", "stalker",
        "boss", "miniboss", "elite", "champion", "legendary",
        "mutant", "infected", "corrupted", "cursed", "possessed",
        "scp", "entity", "nextbot", "backroom", "horror",
        "alien", "extraterrestrial", "xeno",
        "robot", "droid", "android", "cyborg", "mech",
        "elemental", "golem", "construct", "automaton"
    }
    
    -- Ã–nce gÃ¼venli kontrolÃ¼
    for _, pattern in ipairs(safePatterns) do
        if modelName:find(pattern) or modelDisplayName:find(pattern) then
            local distance = playerPosition and (rootPart.Position - playerPosition).Magnitude or 1000
            
            if distance < 30 then
                if rootPart.Velocity.Magnitude > 20 then
                    return true, "Safe NPC but moving fast"
                end
                
                local lookVector = rootPart.CFrame.LookVector
                local toPlayer = (playerPosition - rootPart.Position).Unit
                local dot = lookVector:Dot(toPlayer)
                
                if dot > 0.8 and rootPart.Velocity.Magnitude > 5 then
                    return true, "Safe NPC chasing player"
                end
            end
            
            return false, "Safe NPC pattern: " .. pattern
        end
    end
    
    -- Tehlike kontrolÃ¼
    for _, pattern in ipairs(dangerPatterns) do
        if modelName:find(pattern) or modelDisplayName:find(pattern) then
            return true, "Danger pattern: " .. pattern
        end
    end
    
    -- SCRIPT ANALÄ°ZÄ°
    local dangerScore = 0
    local safeScore = 0
    
    for _, child in pairs(model:GetDescendants()) do
        if child:IsA("Script") or child:IsA("LocalScript") or child:IsA("ModuleScript") then
            local scriptName = child.Name:lower()
            
            local dangerScripts = {
                "attack", "damage", "hurt", "kill", "death", "die",
                "combat", "fight", "battle", "war", "duel",
                "chase", "follow", "pursue", "hunt", "track",
                "aggro", "aggressive", "hostile", "enemyai",
                "patrol", "guard", "defend", "protect",
                "spawn", "summon", "respawn", "regen",
                "boss", "miniboss", "elite", "champion",
                "projectile", "bullet", "arrow", "missile",
                "explosion", "blast", "boom", "fire", "burn",
                "poison", "toxic", "venom", "disease",
                "stun", "freeze", "paralyze", "slow", "debuff"
            }
            
            for _, danger in ipairs(dangerScripts) do
                if scriptName:find(danger) then
                    dangerScore = dangerScore + 2
                end
            end
            
            local safeScripts = {
                "shop", "vendor", "merchant", "trade",
                "quest", "mission", "task", "objective",
                "dialog", "dialogue", "talk", "speak", "conversation",
                "idle", "wait", "stand", "sit", "rest",
                "walk", "move", "wander", "roam",
                "animation", "anim", "pose", "gesture"
            }
            
            for _, safe in ipairs(safeScripts) do
                if scriptName:find(safe) then
                    safeScore = safeScore + 1
                end
            end
        end
        
        if child:IsA("Tool") then
            local toolName = child.Name:lower()
            local weaponKeywords = {
                "sword", "axe", "hammer", "mace", "dagger", "knife",
                "spear", "lance", "pike", "halberd", "trident",
                "bow", "crossbow", "arrow", "quiver",
                "gun", "pistol", "rifle", "shotgun", "sniper",
                "machinegun", "minigun", "gatling", "cannon",
                "rocket", "launcher", "missile", "grenade",
                "bomb", "explosive", "dynamite", "tnt",
                "staff", "wand", "rod", "scepter", "orb",
                "shield", "armor", "helmet", "gauntlet"
            }
            
            for _, weapon in ipairs(weaponKeywords) do
                if toolName:find(weapon) then
                    dangerScore = dangerScore + 3
                    break
                end
            end
        end
        
        if child:IsA("BasePart") then
            local partName = child.Name:lower()
            if partName:find("hitbox") or partName:find("damage") or 
               partName:find("attack") or partName:find("hurt") then
                dangerScore = dangerScore + 2
            end
        end
    end
    
    -- HUMANOID Ã–ZELLÄ°KLERÄ°
    if humanoid then
        if humanoid.WalkSpeed > 25 then
            dangerScore = dangerScore + 1
        end
        if humanoid.WalkSpeed > 40 then
            dangerScore = dangerScore + 2
        end
        
        if humanoid.JumpPower > 50 then
            dangerScore = dangerScore + 1
        end
        
        if humanoid.MaxHealth > 200 then
            dangerScore = dangerScore + 1
        end
        if humanoid.MaxHealth > 1000 then
            dangerScore = dangerScore + 3
        end
        
        if humanoid.Health < humanoid.MaxHealth * 0.3 then
            safeScore = safeScore + 1
        end
    end
    
    -- MESAFE VE DAVRANIÅ ANALÄ°ZÄ°
    if playerPosition then
        local distance = (rootPart.Position - playerPosition).Magnitude
        
        if distance < 50 then
            local lookVector = rootPart.CFrame.LookVector
            local toPlayer = (playerPosition - rootPart.Position).Unit
            local dot = lookVector:Dot(toPlayer)
            
            if dot > 0.5 and rootPart.Velocity.Magnitude > 8 then
                dangerScore = dangerScore + 2
            end
            
            if distance < 20 and rootPart.Velocity.Magnitude > 10 then
                dangerScore = dangerScore + 1
            end
            
            if humanoid and humanoid:GetState() == Enum.HumanoidStateType.GettingUp then
                dangerScore = dangerScore + 1
            end
        else
            safeScore = safeScore + 1
        end
    end
    
    -- SONUÃ‡ HESAPLAMA
    local totalScore = dangerScore - safeScore
    
    if totalScore >= 3 then
        return true, "Danger score: " .. totalScore .. " (D:" .. dangerScore .. " S:" .. safeScore .. ")"
    elseif totalScore <= -2 then
        return false, "Safe score: " .. totalScore .. " (D:" .. dangerScore .. " S:" .. safeScore .. ")"
    else
        if playerPosition then
            local distance = (rootPart.Position - playerPosition).Magnitude
            if distance < 30 and rootPart.Velocity.Magnitude > 5 then
                return true, "Ambiguous but close and moving"
            end
        end
        return false, "Ambiguous, score: " .. totalScore
    end
end

-- NPC TARAMA SÄ°STEMÄ°
local function ScanForDangerousNPCs()
    local currentTime = tick()
    if currentTime - LastScanTime < NPCScanCooldown then
        return
    end
    
    LastScanTime = currentTime
    NPCScanCooldown = 0.5
    
    Character = GetCharacter()
    if not Character then return end
    
    local playerRoot = Character:FindFirstChild("HumanoidRootPart")
    if not playerRoot then return end
    
    local playerPos = playerRoot.Position
    local detectedNPCs = {}
    
    for _, model in pairs(workspace:GetChildren()) do
        if model:IsA("Model") then
            local isDangerous, reason = IsNPCTrulyDangerous(model, playerPos)
            
            if isDangerous then
                local rootPart = model:FindFirstChild("HumanoidRootPart")
                if rootPart then
                    local distance = (rootPart.Position - playerPos).Magnitude
                    
                    table.insert(detectedNPCs, {
                        Model = model,
                        Distance = distance,
                        Reason = reason,
                        RootPart = rootPart
                    })
                end
            end
        end
    end
    
    table.sort(detectedNPCs, function(a, b)
        return a.Distance < b.Distance
    end)
    
    DangerousNPCs = detectedNPCs
end

-- GELÄ°ÅMÄ°Å AUTO RAGDOLL SÄ°STEMÄ°
local function ApplySmartRagdoll(npc, forceMultiplier)
    if not npc or RagdolledNPCs[npc] then return end
    
    local humanoid = npc:FindFirstChildOfClass("Humanoid")
    local rootPart = npc:FindFirstChild("HumanoidRootPart") or 
                    npc:FindFirstChild("Torso") or 
                    npc:FindFirstChild("UpperTorso")
    
    if not humanoid or not rootPart then return end
    
    local originalData = {
        WalkSpeed = humanoid.WalkSpeed,
        JumpPower = humanoid.JumpPower,
        JumpHeight = humanoid.JumpHeight,
        PlatformStand = humanoid.PlatformStand,
        AutoRotate = humanoid.AutoRotate,
        Health = humanoid.Health
    }
    
    local disabledMotors = {}
    for _, motor in pairs(npc:GetDescendants()) do
        if motor:IsA("Motor6D") then
            table.insert(disabledMotors, {
                Motor = motor,
                Enabled = motor.Enabled
            })
            motor.Enabled = false
        end
    end
    
    humanoid.WalkSpeed = 0
    humanoid.JumpPower = 0
    if humanoid.JumpHeight then humanoid.JumpHeight = 0 end
    humanoid.PlatformStand = true
    humanoid.AutoRotate = false
    
    local ragdollForce = forceMultiplier or 1
    
    local flingEffect = Instance.new("BodyAngularVelocity")
    flingEffect.Name = "AutoRagdollFling"
    flingEffect.MaxTorque = Vector3.new(math.huge, math.huge, math.huge)
    flingEffect.AngularVelocity = Vector3.new(
        math.random(-20, 20) * ragdollForce,
        math.random(30, 50) * ragdollForce,
        math.random(-20, 20) * ragdollForce
    )
    flingEffect.P = 10000
    flingEffect.Parent = rootPart
    
    local velocity = rootPart.Velocity
    rootPart.Velocity = Vector3.new(
        velocity.X + math.random(-50, 50) * ragdollForce,
        math.random(30, 80) * ragdollForce,
        velocity.Z + math.random(-50, 50) * ragdollForce
    )
    
    local indicator = Instance.new("BillboardGui")
    indicator.Name = "AutoRagdollIndicator"
    indicator.Size = UDim2.new(0, 120, 0, 40)
    indicator.StudsOffset = Vector3.new(0, 3, 0)
    indicator.AlwaysOnTop = true
    indicator.Adornee = rootPart
    indicator.Parent = rootPart
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.Text = "ğŸ’€ AUTO RAGDOLL"
    label.TextColor3 = Color3.fromRGB(255, 100, 100)
    label.TextSize = 14
    label.Font = Enum.Font.GothamBold
    label.Parent = indicator
    
    local highlight = Instance.new("Highlight")
    highlight.Name = "AutoRagdollHighlight"
    highlight.Adornee = npc
    highlight.FillColor = Color3.fromRGB(255, 50, 50)
    highlight.FillTransparency = 0.8
    highlight.OutlineColor = Color3.fromRGB(255, 100, 100)
    highlight.OutlineTransparency = 0.3
    highlight.Parent = npc
    
    local light = Instance.new("PointLight")
    light.Name = "AutoRagdollLight"
    light.Brightness = 2
    light.Range = 10
    light.Color = Color3.fromRGB(255, 100, 100)
    light.Parent = rootPart
    
    for _, part in pairs(npc:GetDescendants()) do
        if part:IsA("BasePart") then
            part.CanCollide = true
            part.Velocity = part.Velocity + Vector3.new(
                math.random(-30, 30) * ragdollForce,
                math.random(10, 40) * ragdollForce,
                math.random(-30, 30) * ragdollForce
            )
        end
    end
    
    RagdolledNPCs[npc] = {
        OriginalData = originalData,
        DisabledMotors = disabledMotors,
        FlingEffect = flingEffect,
        Indicator = indicator,
        Highlight = highlight,
        Light = light,
        Humanoid = humanoid,
        RootPart = rootPart,
        RagdollTime = tick()
    }
    
    spawn(function()
        local ragdollDuration = 10
        
        for i = ragdollDuration, 0, -1 do
            if not RagdolledNPCs[npc] then break end
            
            if i <= 3 then
                label.Text = "ğŸ’€ GETTING UP " .. i
                label.TextColor3 = Color3.fromRGB(255, 255, 100)
            end
            
            wait(1)
        end
        
        if RagdolledNPCs[npc] then
            RemoveSmartRagdoll(npc)
        end
    end)
end

function RemoveSmartRagdoll(npc)
    if not npc or not RagdolledNPCs[npc] then return end
    
    local data = RagdolledNPCs[npc]
    
    pcall(function()
        if data.Humanoid and data.Humanoid.Parent then
            data.Humanoid.WalkSpeed = data.OriginalData.WalkSpeed
            data.Humanoid.JumpPower = data.OriginalData.JumpPower
            if data.Humanoid.JumpHeight then
                data.Humanoid.JumpHeight = data.OriginalData.JumpHeight
            end
            data.Humanoid.PlatformStand = data.OriginalData.PlatformStand
            data.Humanoid.AutoRotate = data.OriginalData.AutoRotate
            
            data.Humanoid.Health = math.min(data.Humanoid.MaxHealth, data.OriginalData.Health * 0.5)
        end
        
        for _, motorData in pairs(data.DisabledMotors) do
            if motorData.Motor and motorData.Motor.Parent then
                motorData.Motor.Enabled = motorData.Enabled
            end
        end
        
        if data.FlingEffect then data.FlingEffect:Destroy() end
        if data.Indicator then data.Indicator:Destroy() end
        if data.Highlight then data.Highlight:Destroy() end
        if data.Light then data.Light:Destroy() end
        
        if data.RootPart then
            data.RootPart.Velocity = Vector3.new(0, 0, 0)
            data.RootPart.RotVelocity = Vector3.new(0, 0, 0)
        end
    end)
    
    RagdolledNPCs[npc] = nil
end

-- OTOMATÄ°K RAGDOLL KONTROL SÄ°STEMÄ°
function EnableSmartAutoRagdoll()
    Settings.AutoRagdollEnabled = true
    
    print("ğŸ›¡ï¸ AkÄ±llÄ± Auto Ragdoll Aktif!")
    
    Connections.AutoRagdollScan = RunService.Heartbeat:Connect(function()
        if not Settings.AutoRagdollEnabled then return end
        
        ScanForDangerousNPCs()
        
        Character = GetCharacter()
        if not Character then return end
        
        local playerRoot = Character:FindFirstChild("HumanoidRootPart")
        if not playerRoot then return end
        
        local playerPos = playerRoot.Position
        
        for _, npcData in ipairs(DangerousNPCs) do
            local npc = npcData.Model
            local distance = npcData.Distance
            
            if distance < Settings.RagdollDetectionRange then
                if not RagdolledNPCs[npc] then
                    local forceMultiplier = 1
                    if distance < 20 then forceMultiplier = 1.5 end
                    if distance < 10 then forceMultiplier = 2 end
                    
                    ApplySmartRagdoll(npc, forceMultiplier)
                end
            end
        end
    end)
    
    Connections.AutoRagdollFling = RunService.Heartbeat:Connect(function()
        if not Settings.AutoRagdollEnabled then return end
        if not Settings.FlingEnabled then return end
        
        Character = GetCharacter()
        if not Character then return end
        
        local playerRoot = Character:FindFirstChild("HumanoidRootPart")
        if not playerRoot then return end
        
        for _, npcData in ipairs(DangerousNPCs) do
            local npc = npcData.Model
            local distance = npcData.Distance
            
            if distance < 25 and not RagdolledNPCs[npc] then
                ApplySmartRagdoll(npc, 1.2)
            end
        end
    end)
    
    Connections.AutoRagdollBlackHole = RunService.Heartbeat:Connect(function()
        if not Settings.AutoRagdollEnabled then return end
        if not Settings.BlackHoleEnabled then return end
        if not BlackHolePart then return end
        
        local blackHolePos = BlackHolePart.Position
        
        for _, npcData in ipairs(DangerousNPCs) do
            local npc = npcData.Model
            local rootPart = npcData.RootPart
            
            if rootPart then
                local distance = (rootPart.Position - blackHolePos).Magnitude
                
                if distance < 30 and not RagdolledNPCs[npc] then
                    ApplySmartRagdoll(npc, 1.5)
                end
            end
        end
    end)
    
    Connections.AutoRagdollDeath = workspace.DescendantAdded:Connect(function(descendant)
        if not Settings.AutoRagdollEnabled then return end
        
        if descendant:IsA("Model") then
            local humanoid = descendant:FindFirstChildOfClass("Humanoid")
            if humanoid then
                humanoid.Died:Connect(function()
                    wait(0.5)
                    if RagdolledNPCs[descendant] then
                        RemoveSmartRagdoll(descendant)
                    end
                end)
            end
        end
    end)
end

function DisableSmartAutoRagdoll()
    Settings.AutoRagdollEnabled = false
    
    if Connections.AutoRagdollScan then Connections.AutoRagdollScan:Disconnect() end
    if Connections.AutoRagdollFling then Connections.AutoRagdollFling:Disconnect() end
    if Connections.AutoRagdollBlackHole then Connections.AutoRagdollBlackHole:Disconnect() end
    if Connections.AutoRagdollDeath then Connections.AutoRagdollDeath:Disconnect() end
    
    for npc, _ in pairs(RagdolledNPCs) do
        RemoveSmartRagdoll(npc)
    end
    
    DangerousNPCs = {}
    
    print("âŒ AkÄ±llÄ± Auto Ragdoll KapalÄ±")
end

-- RAGDOLL YÃ–NETÄ°M MENÃœSÃœ
local function CreateRagdollManagementMenu()
    local ragdollMenu = Instance.new("ScreenGui")
    ragdollMenu.Name = "RagdollManagementMenu"
    ragdollMenu.ResetOnSpawn = false
    ragdollMenu.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    
    local success = pcall(function() 
        ragdollMenu.Parent = game:GetService("CoreGui") 
    end)
    
    if not success then
        ragdollMenu.Parent = Player:WaitForChild("PlayerGui")
    end
    
    local mainFrame = Instance.new("Frame")
    mainFrame.Name = "MainFrame"
    mainFrame.Size = UDim2.new(0, 350, 0, 450)
    mainFrame.Position = UDim2.new(0.5, -175, 0.5, -225)
    mainFrame.BackgroundColor3 = Color3.fromRGB(40, 30, 60)
    mainFrame.BorderSizePixel = 0
    mainFrame.Active = true
    mainFrame.Draggable = true
    mainFrame.Parent = ragdollMenu
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 12)
    corner.Parent = mainFrame
    
    local stroke = Instance.new("UIStroke")
    stroke.Color = Color3.fromRGB(150, 50, 50)
    stroke.Thickness = 2
    stroke.Parent = mainFrame
    
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, 0, 0, 60)
    title.BackgroundColor3 = Color3.fromRGB(60, 40, 80)
    title.BorderSizePixel = 0
    title.Text = "ğŸ’€ RAGDOLL MANAGER"
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.TextSize = 22
    title.Font = Enum.Font.GothamBold
    title.Parent = mainFrame
    
    local titleCorner = Instance.new("UICorner")
    titleCorner.CornerRadius = UDim.new(0, 12)
    titleCorner.Parent = title
    
    local closeBtn = Instance.new("TextButton")
    closeBtn.Size = UDim2.new(0, 40, 0, 40)
    closeBtn.Position = UDim2.new(1, -50, 0, 10)
    closeBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
    closeBtn.Text = "X"
    closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    closeBtn.TextSize = 20
    closeBtn.Font = Enum.Font.GothamBold
    closeBtn.Parent = title
    
    local btnCorner = Instance.new("UICorner")
    btnCorner.CornerRadius = UDim.new(0, 8)
    btnCorner.Parent = closeBtn
    
    closeBtn.MouseButton1Click:Connect(function()
        ragdollMenu:Destroy()
    end)
    
    local scrollFrame = Instance.new("ScrollingFrame")
    scrollFrame.Name = "ScrollFrame"
    scrollFrame.Size = UDim2.new(1, -20, 1, -80)
    scrollFrame.Position = UDim2.new(0, 10, 0, 70)
    scrollFrame.BackgroundTransparency = 1
    scrollFrame.ScrollBarThickness = 6
    scrollFrame.ScrollBarImageColor3 = Color3.fromRGB(150, 50, 50)
    scrollFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
    scrollFrame.Parent = mainFrame
    
    local content = Instance.new("Frame")
    content.Name = "Content"
    content.Size = UDim2.new(1, 0, 0, 0)
    content.BackgroundTransparency = 1
    content.Parent = scrollFrame
    
    local layout = Instance.new("UIListLayout")
    layout.Padding = UDim.new(0, 10)
    layout.SortOrder = Enum.SortOrder.LayoutOrder
    layout.Parent = content
    
    layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        scrollFrame.CanvasSize = UDim2.new(0, 0, 0, layout.AbsoluteContentSize.Y + 20)
    end)
    
    local counterFrame = Instance.new("Frame")
    counterFrame.Name = "CounterFrame"
    counterFrame.Size = UDim2.new(1, 0, 0, 60)
    counterFrame.BackgroundColor3 = Color3.fromRGB(50, 30, 40)
    counterFrame.BorderSizePixel = 0
    counterFrame.LayoutOrder = 1
    counterFrame.Parent = content
    
    local counterCorner = Instance.new("UICorner")
    counterCorner.CornerRadius = UDim.new(0, 8)
    counterCorner.Parent = counterFrame
    
    local counterLabel = Instance.new("TextLabel")
    counterLabel.Size = UDim2.new(1, 0, 0.5, 0)
    counterLabel.BackgroundTransparency = 1
    counterLabel.Text = "Active Ragdolls: " .. tableSize(RagdolledNPCs)
    counterLabel.TextColor3 = Color3.fromRGB(255, 150, 150)
    counterLabel.TextSize = 18
    counterLabel.Font = Enum.Font.GothamBold
    counterLabel.Parent = counterFrame
    
    local infoLabel = Instance.new("TextLabel")
    infoLabel.Size = UDim2.new(1, 0, 0.5, 0)
    infoLabel.Position = UDim2.new(0, 0, 0.5, 0)
    infoLabel.BackgroundTransparency = 1
    infoLabel.Text = "ğŸ’€ NPCs currently ragdolled"
    infoLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
    infoLabel.TextSize = 14
    infoLabel.Font = Enum.Font.Gotham
    infoLabel.Parent = counterFrame
    
    local buttonData = {
        {Name = "ğŸ”„ Refresh List", Color = Color3.fromRGB(100, 150, 255), Action = function()
            counterLabel.Text = "Active Ragdolls: " .. tableSize(RagdolledNPCs)
        end},
        {Name = "ğŸ—‘ï¸ Clear All Ragdolls", Color = Color3.fromRGB(255, 100, 100), Action = function()
            for npc, _ in pairs(RagdolledNPCs) do
                RemoveSmartRagdoll(npc)
            end
            counterLabel.Text = "Active Ragdolls: 0"
        end},
        {Name = "ğŸ¯ Ragdoll All Dangerous", Color = Color3.fromRGB(255, 150, 50), Action = function()
            for _, npcData in ipairs(DangerousNPCs) do
                if not RagdolledNPCs[npcData.Model] then
                    ApplySmartRagdoll(npcData.Model, 1)
                end
            end
            wait(0.5)
            counterLabel.Text = "Active Ragdolls: " .. tableSize(RagdolledNPCs)
        end},
        {Name = "ğŸ›¡ï¸ Toggle Auto Ragdoll", Color = Color3.fromRGB(100, 255, 100), Action = function()
            if Settings.AutoRagdollEnabled then
                DisableSmartAutoRagdoll()
            else
                EnableSmartAutoRagdoll()
            end
        end},
        {Name = "ğŸ“Š NPC Detection Settings", Color = Color3.fromRGB(180, 100, 255), Action = function()
            print("NPC Detection Settings:")
            print("â€¢ Range: " .. Settings.RagdollDetectionRange .. " studs")
            print("â€¢ Cooldown: " .. NPCScanCooldown .. " seconds")
            print("â€¢ Dangerous NPCs found: " .. #DangerousNPCs)
        end}
    }
    
    for i, btnInfo in ipairs(buttonData) do
        local button = Instance.new("TextButton")
        button.Size = UDim2.new(1, 0, 0, 50)
        button.BackgroundColor3 = btnInfo.Color
        button.Text = btnInfo.Name
        button.TextColor3 = Color3.fromRGB(255, 255, 255)
        button.TextSize = 16
        button.Font = Enum.Font.GothamSemibold
        button.LayoutOrder = i + 1
        button.Parent = content
        
        local btnCorner2 = Instance.new("UICorner")
        btnCorner2.CornerRadius = UDim.new(0, 8)
        btnCorner2.Parent = button
        
        button.MouseButton1Click:Connect(function()
            btnInfo.Action()
        end)
    end
    
    local listHeader = Instance.new("TextLabel")
    listHeader.Size = UDim2.new(1, 0, 0, 40)
    listHeader.BackgroundColor3 = Color3.fromRGB(60, 40, 50)
    listHeader.BorderSizePixel = 0
    listHeader.Text = "ğŸ¯ Detected Dangerous NPCs"
    listHeader.TextColor3 = Color3.fromRGB(255, 200, 200)
    listHeader.TextSize = 16
    listHeader.Font = Enum.Font.GothamBold
    listHeader.LayoutOrder = #buttonData + 2
    listHeader.Parent = content
    
    local headerCorner = Instance.new("UICorner")
    headerCorner.CornerRadius = UDim.new(0, 8)
    headerCorner.Parent = listHeader
    
    spawn(function()
        while ragdollMenu and ragdollMenu.Parent do
            counterLabel.Text = "Active Ragdolls: " .. tableSize(RagdolledNPCs)
            
            for _, child in pairs(content:GetChildren()) do
                if child.Name == "NPCItem" then
                    child:Destroy()
                end
            end
            
            local startOrder = #buttonData + 3
            
            for i, npcData in ipairs(DangerousNPCs) do
                if i <= 10 then
                    local npcItem = Instance.new("Frame")
                    npcItem.Name = "NPCItem"
                    npcItem.Size = UDim2.new(1, 0, 0, 40)
                    npcItem.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
                    npcItem.BorderSizePixel = 0
                    npcItem.LayoutOrder = startOrder + i
                    npcItem.Parent = content
                    
                    local itemCorner = Instance.new("UICorner")
                    itemCorner.CornerRadius = UDim.new(0, 6)
                    itemCorner.Parent = npcItem
                    
                    local nameLabel = Instance.new("TextLabel")
                    nameLabel.Size = UDim2.new(0.6, -10, 1, 0)
                    nameLabel.Position = UDim2.new(0, 10, 0, 0)
                    nameLabel.BackgroundTransparency = 1
                    nameLabel.Text = npcData.Model.Name
                    nameLabel.TextColor3 = Color3.fromRGB(255, 150, 150)
                    nameLabel.TextSize = 14
                    nameLabel.Font = Enum.Font.Gotham
                    nameLabel.TextXAlignment = Enum.TextXAlignment.Left
                    nameLabel.Parent = npcItem
                    
                    local distanceLabel = Instance.new("TextLabel")
                    distanceLabel.Size = UDim2.new(0.4, -10, 1, 0)
                    distanceLabel.Position = UDim2.new(0.6, 0, 0, 0)
                    distanceLabel.BackgroundTransparency = 1
                    distanceLabel.Text = math.floor(npcData.Distance) .. " studs"
                    distanceLabel.TextColor3 = Color3.fromRGB(200, 200, 255)
                    distanceLabel.TextSize = 13
                    distanceLabel.Font = Enum.Font.Gotham
                    distanceLabel.TextXAlignment = Enum.TextXAlignment.Right
                    distanceLabel.Parent = npcItem
                end
            end
            
            wait(1)
        end
    end)
    
    return ragdollMenu
end

-- RAGDOLL MENÃœSÃœNÃœ AÃ‡
function OpenRagdollMenu()
    local oldMenu = (game:GetService("CoreGui"):FindFirstChild("RagdollManagementMenu")) or 
                    (Player.PlayerGui:FindFirstChild("RagdollManagementMenu"))
    if oldMenu then oldMenu:Destroy() end
    
    CreateRagdollManagementMenu()
end

-- KARAKTER DEÄÄ°ÅÄ°KLÄ°ÄÄ° Ä°Ã‡Ä°N OTOMATÄ°K AYARLAMA
Player.CharacterAdded:Connect(function(char)
    Character = char
    HumanoidRootPart = char:WaitForChild("HumanoidRootPart", 10)
    
    if Settings.AutoRagdollEnabled then
        wait(1)
        DisableSmartAutoRagdoll()
        EnableSmartAutoRagdoll()
    end
end)

-- OYUN BAÅLANGICI BÄ°LGÄ° MESAJI
spawn(function()
    wait(1)
    print("=== PART 6 YÃœKLENDÄ° ===")
    print("ğŸ“¦ Yeni Ã–zellikler:")
    print("")
    print("   âœ… GELÄ°ÅMÄ°Å NPC TESPÄ°T SÄ°STEMÄ°")
    print("   âœ… AKILLI AUTO RAGDOLL")
    print("   âœ… RAGDOLL YÃ–NETÄ°M MENÃœSÃœ")
    print("==========================")
end)

-- GLOBAL FONKSÄ°YONLARI EXPORT ET
_G.EnableSmartAutoRagdoll = EnableSmartAutoRagdoll
_G.DisableSmartAutoRagdoll = DisableSmartAutoRagdoll
_G.OpenRagdollMenu = OpenRagdollMenu
_G.ApplySmartRagdoll = ApplySmartRagdoll
_G.RemoveSmartRagdoll = RemoveSmartRagdoll-- Universal Tool v5.0 - Part 7/7
-- SÄ°STEM BÄ°RLEÅTÄ°RME + HATA KONTROLLERÄ° + OPTÄ°MÄ°ZASYON

-- Ã–NCEKÄ° PART'LARDAN GEREKLÄ° DEÄÄ°ÅKENLER (Eksik olanlar eklendi)
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local VirtualInputManager = game:GetService("VirtualInputManager")

local Player = Players.LocalPlayer
local Character = Player.Character or Player.CharacterAdded:Wait()
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")

-- GLOBAL DEÄÄ°ÅKENLER (Ã–nceki part'lardan geldiÄŸi varsayÄ±lan)
Settings = Settings or {}
Connections = Connections or {}
RagdolledNPCs = RagdolledNPCs or {}
ESPObjects = ESPObjects or {}
ItemESPObjects = ItemESPObjects or {}
PlayerESPObjects = PlayerESPObjects or {}
NoClipParts = NoClipParts or {}
MobileGUI = MobileGUI or {}
GUIFunctions = GUIFunctions or {}

-- FONKSÄ°YON REFERANSLARI (Ã–nceki part'lardan)
local FlyBodyGyro, FlyBodyVelocity
local GodModeClone
local BlackHolePart
local FlingPart

-- TÃœM SÄ°STEMLERÄ° BÄ°RLEÅTÄ°REN ANA KONTROL SÄ°STEMÄ°
local UniversalSystems = {
    Active = {},
    Settings = Settings,
    Connections = Connections,
    Performance = {
        LastCleanup = 0,
        CleanupInterval = 30,
        MemoryUsage = 0,
        FPS = 60,
        UpdateRate = 1
    }
}

-- GLOBAL HATA YAKALAMA SÄ°STEMÄ°
local function SafeCall(func, name, ...)
    local success, result = pcall(func, ...)
    if not success then
        warn("âš ï¸ [" .. name .. "] Hata: " .. tostring(result))
        return nil
    end
    return result
end

-- KARAKTER GÃœNCELLEME FONKSÄ°YONU
local function GetCharacter()
    if Player.Character and Player.Character:FindFirstChild("HumanoidRootPart") then
        return Player.Character
    end
    return nil
end

-- PERFORMANS MONÄ°TÃ–RÃœ
local function InitializePerformanceMonitor()
    local monitor = {
        FrameCount = 0,
        LastCheck = tick(),
        MinFPS = 60,
        MaxFPS = 0,
        AverageFPS = 60
    }
    
    Connections.PerformanceMonitor = RunService.RenderStepped:Connect(function()
        monitor.FrameCount = monitor.FrameCount + 1
        
        local currentTime = tick()
        if currentTime - monitor.LastCheck >= 1 then
            local fps = monitor.FrameCount
            monitor.FrameCount = 0
            monitor.LastCheck = currentTime
            
            UniversalSystems.Performance.FPS = fps
            
            monitor.MinFPS = math.min(monitor.MinFPS, fps)
            monitor.MaxFPS = math.max(monitor.MaxFPS, fps)
            monitor.AverageFPS = (monitor.AverageFPS * 0.9) + (fps * 0.1)
            
            if fps < 30 then
                UniversalSystems.Performance.UpdateRate = 2
            elseif fps > 50 then
                UniversalSystems.Performance.UpdateRate = 1
            end
        end
    end)
    
    return monitor
end

-- OTOMATÄ°K TEMÄ°ZLÄ°K SÄ°STEMÄ°
local function PerformCleanup()
    local currentTime = tick()
    if currentTime - UniversalSystems.Performance.LastCleanup < UniversalSystems.Performance.CleanupInterval then
        return
    end
    
    UniversalSystems.Performance.LastCleanup = currentTime
    
    print("ğŸ§¹ Sistem temizliÄŸi baÅŸlatÄ±lÄ±yor...")
    
    -- GARBAGE COLLECTION
    local memBefore = collectgarbage("count")
    collectgarbage("collect")
    local memAfter = collectgarbage("count")
    UniversalSystems.Performance.MemoryUsage = memAfter
    
    print(string.format("   â€¢ Bellek: %.2f MB -> %.2f MB (%.2f MB tasarruf)", 
        memBefore/1024, memAfter/1024, (memBefore-memAfter)/1024))
    
    -- Ã–LÃœ NPC'LERÄ° TEMÄ°ZLE
    local deadNPCs = 0
    for npc, data in pairs(RagdolledNPCs) do
        if not npc or not npc.Parent then
            if RemoveSmartRagdoll then
                RemoveSmartRagdoll(npc)
            end
            RagdolledNPCs[npc] = nil
            deadNPCs = deadNPCs + 1
        elseif data.Humanoid and data.Humanoid.Health <= 0 then
            if RemoveSmartRagdoll then
                RemoveSmartRagdoll(npc)
            end
            RagdolledNPCs[npc] = nil
            deadNPCs = deadNPCs + 1
        end
    end
    
    if deadNPCs > 0 then
        print("   â€¢ " .. deadNPCs .. " Ã¶lÃ¼ NPC ragdoll temizlendi")
    end
    
    -- Ã–LÃœ ESP'LERÄ° TEMÄ°ZLE
    local deadESP = 0
    for npc, data in pairs(ESPObjects) do
        if not npc or not npc.Parent then
            if RemoveESPForNPC then
                RemoveESPForNPC(npc)
            end
            ESPObjects[npc] = nil
            deadESP = deadESP + 1
        end
    end
    
    for item, data in pairs(ItemESPObjects) do
        if not item or not item.Parent then
            if RemoveItemESP then
                RemoveItemESP(item)
            end
            ItemESPObjects[item] = nil
            deadESP = deadESP + 1
        end
    end
    
    for player, data in pairs(PlayerESPObjects) do
        if not player or not player.Parent or not data.Character or not data.Character.Parent then
            if RemovePlayerESP then
                RemovePlayerESP(player)
            end
            PlayerESPObjects[player] = nil
            deadESP = deadESP + 1
        end
    end
    
    if deadESP > 0 then
        print("   â€¢ " .. deadESP .. " Ã¶lÃ¼ ESP temizlendi")
    end
    
    -- BAÄLANTILARI KONTROL ET
    local deadConnections = 0
    for name, connection in pairs(Connections) do
        if not connection or not connection.Connected then
            Connections[name] = nil
            deadConnections = deadConnections + 1
        end
    end
    
    if deadConnections > 0 then
        print("   â€¢ " .. deadConnections .. " Ã¶lÃ¼ baÄŸlantÄ± temizlendi")
    end
    
    -- NO CLIP PARÃ‡ALARINI KONTROL ET
    local deadNoClip = 0
    for i = #NoClipParts, 1, -1 do
        local data = NoClipParts[i]
        if not data.Part or not data.Part.Parent then
            table.remove(NoClipParts, i)
            deadNoClip = deadNoClip + 1
        end
    end
    
    if deadNoClip > 0 then
        print("   â€¢ " .. deadNoClip .. " Ã¶lÃ¼ NoClip parÃ§asÄ± temizlendi")
    end
    
    -- MOBÄ°LE GUI KONTROLÃœ
    if MobileGUI and MobileGUI.GUI and not MobileGUI.GUI.Parent then
        print("   â€¢ Mobile GUI yeniden oluÅŸturuluyor...")
        if InitializeGUI then
            InitializeGUI()
        end
    end
    
    print("âœ… Sistem temizliÄŸi tamamlandÄ±!")
end

-- SÄ°STEM DURUM YÃ–NETÄ°CÄ°SÄ°
local SystemManager = {
    Systems = {
        Fly = {Enabled = false, EnableFunc = function() if EnableMobileFly then EnableMobileFly() end end, DisableFunc = function() if DisableMobileFly then DisableMobileFly() end end},
        NoClip = {Enabled = false, EnableFunc = function() if EnableEnhancedNoClip then EnableEnhancedNoClip() end end, DisableFunc = function() if DisableEnhancedNoClip then DisableEnhancedNoClip() end end},
        GodMode = {Enabled = false, EnableFunc = function() if EnableGodMode then EnableGodMode() end end, DisableFunc = function() if DisableGodMode then DisableGodMode() end end},
        FullBright = {Enabled = false, EnableFunc = function() if EnableFullBright then EnableFullBright() end end, DisableFunc = function() if DisableFullBright then DisableFullBright() end end},
        ESP = {Enabled = false, EnableFunc = function() 
            if EnableESP then EnableESP() end
            if EnableItemESP then EnableItemESP() end
            if EnablePlayerESP then EnablePlayerESP() end
        end, DisableFunc = function()
            if DisableESP then DisableESP() end
            if DisableItemESP then DisableItemESP() end
            if DisablePlayerESP then DisablePlayerESP() end
        end},
        BlackHole = {Enabled = false, EnableFunc = function() if EnableAdvancedBlackHole then EnableAdvancedBlackHole() end end, DisableFunc = function() if DisableAdvancedBlackHole then DisableAdvancedBlackHole() end end},
        WalkFling = {Enabled = false, EnableFunc = function() if EnableWalkFling then EnableWalkFling() end end, DisableFunc = function() if DisableWalkFling then DisableWalkFling() end end},
        AutoRagdoll = {Enabled = false, EnableFunc = function() if EnableSmartAutoRagdoll then EnableSmartAutoRagdoll() end end, DisableFunc = function() if DisableSmartAutoRagdoll then DisableSmartAutoRagdoll() end end}
    },
    
    ToggleSystem = function(self, systemName)
        local system = self.Systems[systemName]
        if not system then
            warn("âš ï¸ Sistem bulunamadÄ±: " .. systemName)
            return
        end
        
        system.Enabled = not system.Enabled
        
        SafeCall(function()
            if system.Enabled then
                system.EnableFunc()
                print("âœ… " .. systemName .. " sistemi AKTÄ°F")
            else
                system.DisableFunc()
                print("âŒ " .. systemName .. " sistemi KAPALI")
            end
        end, "ToggleSystem_" .. systemName)
        
        -- GUI gÃ¼ncellemesi
        if GUIFunctions and GUIFunctions.toggles and GUIFunctions.toggles[systemName] then
            GUIFunctions.toggles[systemName].SetState(system.Enabled)
        end
        
        return system.Enabled
    end,
    
    EnableAll = function(self)
        print("âš¡ TÃœM SÄ°STEMLER AKTÄ°F EDÄ°LÄ°YOR...")
        for name, system in pairs(self.Systems) do
            if not system.Enabled then
                self:ToggleSystem(name)
                task.wait(0.1)
            end
        end
        print("âœ… TÃ¼m sistemler aktif!")
    end,
    
    DisableAll = function(self)
        print("ğŸ›‘ TÃœM SÄ°STEMLER KAPATILIYOR...")
        for name, system in pairs(self.Systems) do
            if system.Enabled then
                self:ToggleSystem(name)
                task.wait(0.1)
            end
        end
        print("âœ… TÃ¼m sistemler kapalÄ±!")
    end,
    
    GetStatus = function(self)
        local status = {}
        for name, system in pairs(self.Systems) do
            status[name] = system.Enabled
        end
        return status
    end,
    
    GetPerformance = function(self)
        return UniversalSystems.Performance
    end
}

-- KOMUT SÄ°STEMÄ°
local function InitializeCommandSystem()
    local commands = {
        ["/help"] = function()
            print("=== ğŸ® UNIVERSAL TOOL v5.0 KOMUTLARI ===")
            print("/help - Bu mesajÄ± gÃ¶ster")
            print("/status - Sistem durumunu gÃ¶ster")
            print("/toggle [sistem] - Sistem aÃ§/kapa")
            print("/enableall - TÃ¼m sistemleri aÃ§")
            print("/disableall - TÃ¼m sistemleri kapat")
            print("/cleanup - Temizlik yap")
            print("/ragdollmenu - Ragdoll menÃ¼sÃ¼nÃ¼ aÃ§")
            print("/bringmenu - Bring menÃ¼sÃ¼nÃ¼ aÃ§")
            print("/performance - Performans bilgisi")
            print("======================================")
        end,
        
        ["/status"] = function()
            local status = SystemManager:GetStatus()
            print("=== ğŸ“Š SÄ°STEM DURUMU ===")
            for name, enabled in pairs(status) do
                print(string.format("   %s: %s", name, enabled and "âœ… AKTÄ°F" or "âŒ KAPALI"))
            end
            print("======================")
        end,
        
        ["/toggle"] = function(args)
            if not args or args == "" then
                print("KullanÄ±m: /toggle [sistem]")
                print("Sistemler: fly, noclip, godmode, fullbright, esp, blackhole, fling, autoragdoll")
                return
            end
            
            local systemName = args:lower()
            local systemMap = {
                ["fly"] = "Fly",
                ["noclip"] = "NoClip",
                ["godmode"] = "GodMode",
                ["fullbright"] = "FullBright",
                ["esp"] = "ESP",
                ["blackhole"] = "BlackHole",
                ["fling"] = "WalkFling",
                ["autoragdoll"] = "AutoRagdoll"
            }
            
            local mappedName = systemMap[systemName]
            if mappedName then
                SystemManager:ToggleSystem(mappedName)
            else
                print("âš ï¸ GeÃ§ersiz sistem: " .. systemName)
            end
        end,
        
        ["/enableall"] = function()
            SystemManager:EnableAll()
        end,
        
        ["/disableall"] = function()
            SystemManager:DisableAll()
        end,
        
        ["/cleanup"] = function()
            PerformCleanup()
        end,
        
        ["/ragdollmenu"] = function()
            if OpenRagdollMenu then OpenRagdollMenu() end
        end,
        
        ["/bringmenu"] = function()
            if OpenBringMenu then OpenBringMenu() end
        end,
        
        ["/performance"] = function()
            local perf = SystemManager:GetPerformance()
            print("=== ğŸ“ˆ PERFORMANS BÄ°LGÄ°SÄ° ===")
            print(string.format("   â€¢ FPS: %d", perf.FPS))
            print(string.format("   â€¢ Bellek: %.2f MB", perf.MemoryUsage/1024))
            print(string.format("   â€¢ GÃ¼ncelleme HÄ±zÄ±: %dx", perf.UpdateRate))
            print(string.format("   â€¢ Son Temizlik: %.0f saniye Ã¶nce", tick() - perf.LastCleanup))
            print("=============================")
        end
    }
    
    -- CHAT MESSAGE LISTENER
    local function ProcessMessage(message)
        if message:sub(1, 1) == "/" then
            local parts = {}
            for part in message:gmatch("%S+") do
                table.insert(parts, part)
            end
            
            local command = parts[1]:lower()
            local args = message:sub(#command + 2)
            
            if commands[command] then
                SafeCall(function()
                    commands[command](args)
                end, "Command_" .. command)
                return true
            else
                print("âš ï¸ Bilinmeyen komut: " .. command)
                print("   /help yazarak tÃ¼m komutlarÄ± gÃ¶rebilirsin")
                return true
            end
        end
        return false
    end
    
    -- TEXTCHATSERVICE DESTEÄI
    pcall(function()
        local TextChatService = game:GetService("TextChatService")
        if TextChatService:FindFirstChild("TextChannels") then
            local channel = TextChatService.TextChannels:FindFirstChild("RBXGeneral")
            if channel then
                Connections.ChatMessage = channel.MessageReceived:Connect(function(message)
                    if message.TextSource and message.TextSource.UserId == Player.UserId then
                        ProcessMessage(message.Text)
                    end
                end)
            end
        end
    end)
    
    print("âœ… Komut sistemi yÃ¼klendi!")
    print("   â€¢ /help - Komut listesi")
end

-- OTOMATÄ°K KURTARMA SÄ°STEMÄ°
local function InitializeRecoverySystem()
    local recovery = {
        LastCheck = tick(),
        CheckInterval = 10,
        MaxRecoveryAttempts = 3,
        RecoveryAttempts = {}
    }
    
    Connections.RecoveryCheck = RunService.Heartbeat:Connect(function()
        local currentTime = tick()
        if currentTime - recovery.LastCheck < recovery.CheckInterval then
            return
        end
        
        recovery.LastCheck = currentTime
        
        -- KARAKTER KONTROLÃœ
        if not Character or not Character.Parent then
            Character = GetCharacter()
            if Character then
                HumanoidRootPart = Character:FindFirstChild("HumanoidRootPart")
                print("ğŸ”„ Karakter yeniden yÃ¼klendi")
            end
        end
        
        -- SÄ°STEM KONTROLLERÄ°
        for systemName, system in pairs(SystemManager.Systems) do
            if system.Enabled then
                local isWorking = true
                
                if systemName == "Fly" then
                    isWorking = FlyBodyGyro and FlyBodyGyro.Parent
                elseif systemName == "NoClip" then
                    isWorking = Settings.NoClipEnabled
                elseif systemName == "GodMode" then
                    isWorking = GodModeClone and GodModeClone.Parent
                elseif systemName == "ESP" then
                    isWorking = Settings.ESPEnabled
                elseif systemName == "BlackHole" then
                    isWorking = BlackHolePart and BlackHolePart.Parent
                elseif systemName == "WalkFling" then
                    isWorking = FlingPart and FlingPart.Parent
                elseif systemName == "AutoRagdoll" then
                    isWorking = Settings.AutoRagdollEnabled
                end
                
                if not isWorking then
                    recovery.RecoveryAttempts[systemName] = (recovery.RecoveryAttempts[systemName] or 0) + 1
                    
                    if recovery.RecoveryAttempts[systemName] <= recovery.MaxRecoveryAttempts then
                        print("âš ï¸ " .. systemName .. " sistemi Ã§Ã¶ktÃ¼, kurtarÄ±lÄ±yor... (" .. 
                              recovery.RecoveryAttempts[systemName] .. "/" .. recovery.MaxRecoveryAttempts .. ")")
                        
                        SafeCall(function()
                            system.DisableFunc()
                            task.wait(0.1)
                            system.EnableFunc()
                        end, "Recovery_" .. systemName)
                    else
                        print("âŒ " .. systemName .. " sistemi kurtarÄ±lamadÄ±, kapatÄ±lÄ±yor...")
                        SystemManager:ToggleSystem(systemName)
                        recovery.RecoveryAttempts[systemName] = nil
                    end
                else
                    recovery.RecoveryAttempts[systemName] = nil
                end
            end
        end
    end)
end

-- GÃœVENLÄ°K KONTROLLERÄ°
local function InitializeSecurityChecks()
    local security = {
        LastAntiAfk = tick(),
        AntiAfkInterval = 30
    }
    
    -- ANTI-AFK
    Connections.AntiAfk = RunService.Heartbeat:Connect(function()
        local currentTime = tick()
        if currentTime - security.LastAntiAfk >= security.AntiAfkInterval then
            security.LastAntiAfk = currentTime
            
            pcall(function()
                VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.W, false, game)
                task.wait(0.05)
                VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.W, false, game)
            end)
        end
    end)
end

-- HOTKEY SÄ°STEMÄ°
local function InitializeHotkeySystem()
    local hotkeys = {
        [Enum.KeyCode.F1] = function() SystemManager:ToggleSystem("Fly") end,
        [Enum.KeyCode.F2] = function() SystemManager:ToggleSystem("NoClip") end,
        [Enum.KeyCode.F3] = function() SystemManager:ToggleSystem("GodMode") end,
        [Enum.KeyCode.F4] = function() SystemManager:ToggleSystem("FullBright") end,
        [Enum.KeyCode.F5] = function() SystemManager:ToggleSystem("ESP") end,
        [Enum.KeyCode.F6] = function() SystemManager:ToggleSystem("BlackHole") end,
        [Enum.KeyCode.F7] = function() SystemManager:ToggleSystem("WalkFling") end,
        [Enum.KeyCode.F8] = function() SystemManager:ToggleSystem("AutoRagdoll") end,
        [Enum.KeyCode.F10] = function() SystemManager:DisableAll() end,
        [Enum.KeyCode.F11] = function() PerformCleanup() end,
        [Enum.KeyCode.F12] = function() 
            if MobileGUI and MobileGUI.GUI then
                MobileGUI.GUI.Enabled = not MobileGUI.GUI.Enabled
            end
        end,
        [Enum.KeyCode.Insert] = function() if OpenBringMenu then OpenBringMenu() end end,
        [Enum.KeyCode.Delete] = function() if OpenRagdollMenu then OpenRagdollMenu() end end
    }
    
    Connections.HotkeyInput = UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if gameProcessed then return end
        
        if input.KeyCode and hotkeys[input.KeyCode] then
            SafeCall(hotkeys[input.KeyCode], "Hotkey_" .. tostring(input.KeyCode))
        end
    end)
    
    print("âœ… Hotkey sistemi yÃ¼klendi!")
end

-- MOBÄ°LE GESTURE SÄ°STEMÄ°
local function InitializeMobileGestures()
    if not UserInputService.TouchEnabled then return end
    
    local touchStartPos = nil
    local touchStartTime = 0
    local touchMoved = false
    local lastTapTime = 0
    
    Connections.TouchBegan = UserInputService.TouchStarted:Connect(function(touch, gameProcessed)
        if gameProcessed then return end
        
        touchStartPos = touch.Position
        touchStartTime = tick()
        touchMoved = false
        
        -- Ã‡ift tÄ±klama
        if tick() - lastTapTime < 0.3 then
            SystemManager:ToggleSystem("Fly")
            lastTapTime = 0
        else
            lastTapTime = tick()
        end
    end)
    
    Connections.TouchMoved = UserInputService.TouchMoved:Connect(function(touch, gameProcessed)
        if gameProcessed then return end
        touchMoved = true
    end)
    
    Connections.TouchEnded = UserInputService.TouchEnded:Connect(function(touch, gameProcessed)
        if gameProcessed or not touchStartPos then return end
        
        local touchDuration = tick() - touchStartTime
        
        -- Uzun basma
        if touchDuration > 0.5 and not touchMoved then
            SystemManager:ToggleSystem("ESP")
        end
        
        touchStartPos = nil
    end)
    
    print("âœ… Mobile gesture sistemi yÃ¼klendi!")
end

-- VARSAYILAN AYARLAR
local function ApplyDefaultSettings()
    Settings.FlySpeed = Settings.FlySpeed or 50
    Settings.PullForce = Settings.PullForce or 50
    Settings.PullRadius = Settings.PullRadius or 150
    Settings.RagdollDetectionRange = Settings.RagdollDetectionRange or 100
    Settings.ESPUpdateRate = Settings.ESPUpdateRate or 5
    Settings.FlingMultiplier = Settings.FlingMultiplier or 100
end

-- ANA BAÅLATMA
local function InitializeUniversalTool()
    print("\n" .. string.rep("=", 50))
    print("      ğŸŒ€ UNIVERSAL TOOL v5.0 - DELTA EXECUTOR")
    print(string.rep("=", 50))
    
    SafeCall(InitializePerformanceMonitor, "PerformanceMonitor")
    SafeCall(InitializeSecurityChecks, "SecurityChecks")
    SafeCall(InitializeRecoverySystem, "RecoverySystem")
    SafeCall(InitializeCommandSystem, "CommandSystem")
    SafeCall(InitializeHotkeySystem, "HotkeySystem")
    SafeCall(InitializeMobileGestures, "MobileGestures")
    SafeCall(ApplyDefaultSettings, "DefaultSettings")
    
    Connections.AutoCleanup = RunService.Heartbeat:Connect(function()
        PerformCleanup()
    end)
    
    task.wait(2)
    print("\nâœ… UNIVERSAL TOOL v5.0 TAMAMEN YÃœKLENDÄ°!")
    print("   ğŸ“± /help - Komut listesi")
    print("   ğŸ® F1-F12 - Hotkey'ler")
    print(string.rep("=", 50) .. "\n")
end

-- BAÅLAT
Player.CharacterAdded:Connect(function(char)
    Character = char
    HumanoidRootPart = char:WaitForChild("HumanoidRootPart")
end)

InitializeUniversalTool()

-- TEMÄ°ZLÄ°K
Players.PlayerRemoving:Connect(function(leavingPlayer)
    if leavingPlayer == Player then
        SystemManager:DisableAll()
        for _, connection in pairs(Connections) do
            pcall(function() connection:Disconnect() end)
        end
        if MobileGUI and MobileGUI.GUI then
            MobileGUI.GUI:Destroy()
        end
    end
end)
